a7df5510283c94f0a7ed724f428505d3
'use strict';

var Dimensions = require('../Utilities/Dimensions');
var FrameRateLogger = require('../Interaction/FrameRateLogger');
var Keyboard = require('./Keyboard/Keyboard');
var ReactNative = require('../Renderer/shims/ReactNative');
var TextInputState = require('./TextInput/TextInputState');
var UIManager = require('../ReactNative/UIManager');
var invariant = require('invariant');
var nullthrows = require('nullthrows');
var performanceNow = require('fbjs/lib/performanceNow');
var warning = require('fbjs/lib/warning');
var _require = require('../BatchedBridge/NativeModules'),
  ScrollViewManager = _require.ScrollViewManager;
var IS_ANIMATING_TOUCH_START_THRESHOLD_MS = 16;
var ScrollResponderMixin = {
  _subscriptionKeyboardWillShow: null,
  _subscriptionKeyboardWillHide: null,
  _subscriptionKeyboardDidShow: null,
  _subscriptionKeyboardDidHide: null,
  scrollResponderMixinGetInitialState: function scrollResponderMixinGetInitialState() {
    return {
      isTouching: false,
      lastMomentumScrollBeginTime: 0,
      lastMomentumScrollEndTime: 0,
      observedScrollSinceBecomingResponder: false,
      becameResponderWhileAnimating: false
    };
  },
  scrollResponderHandleScrollShouldSetResponder: function scrollResponderHandleScrollShouldSetResponder() {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }
    return this.state.isTouching;
  },
  scrollResponderHandleStartShouldSetResponder: function scrollResponderHandleStartShouldSetResponder(e) {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();
    if (this.props.keyboardShouldPersistTaps === 'handled' && currentlyFocusedTextInput != null && e.target !== currentlyFocusedTextInput) {
      return true;
    }
    return false;
  },
  scrollResponderHandleStartShouldSetResponderCapture: function scrollResponderHandleStartShouldSetResponderCapture(e) {
    if (this.scrollResponderIsAnimating()) {
      return true;
    }
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    var keyboardNeverPersistTaps = !keyboardShouldPersistTaps || keyboardShouldPersistTaps === 'never';
    if (keyboardNeverPersistTaps && currentlyFocusedTextInput != null && e.target && !TextInputState.isTextInput(e.target)) {
      return true;
    }
    return false;
  },
  scrollResponderHandleResponderReject: function scrollResponderHandleResponderReject() {},
  scrollResponderHandleTerminationRequest: function scrollResponderHandleTerminationRequest() {
    return !this.state.observedScrollSinceBecomingResponder;
  },
  scrollResponderHandleTouchEnd: function scrollResponderHandleTouchEnd(e) {
    var nativeEvent = e.nativeEvent;
    this.state.isTouching = nativeEvent.touches.length !== 0;
    this.props.onTouchEnd && this.props.onTouchEnd(e);
  },
  scrollResponderHandleTouchCancel: function scrollResponderHandleTouchCancel(e) {
    this.state.isTouching = false;
    this.props.onTouchCancel && this.props.onTouchCancel(e);
  },
  scrollResponderHandleResponderRelease: function scrollResponderHandleResponderRelease(e) {
    this.props.onResponderRelease && this.props.onResponderRelease(e);
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();
    if (this.props.keyboardShouldPersistTaps !== true && this.props.keyboardShouldPersistTaps !== 'always' && currentlyFocusedTextInput != null && e.target !== currentlyFocusedTextInput && !this.state.observedScrollSinceBecomingResponder && !this.state.becameResponderWhileAnimating) {
      this.props.onScrollResponderKeyboardDismissed && this.props.onScrollResponderKeyboardDismissed(e);
      TextInputState.blurTextInput(currentlyFocusedTextInput);
    }
  },
  scrollResponderHandleScroll: function scrollResponderHandleScroll(e) {
    this.state.observedScrollSinceBecomingResponder = true;
    this.props.onScroll && this.props.onScroll(e);
  },
  scrollResponderHandleResponderGrant: function scrollResponderHandleResponderGrant(e) {
    this.state.observedScrollSinceBecomingResponder = false;
    this.props.onResponderGrant && this.props.onResponderGrant(e);
    this.state.becameResponderWhileAnimating = this.scrollResponderIsAnimating();
  },
  scrollResponderHandleScrollBeginDrag: function scrollResponderHandleScrollBeginDrag(e) {
    FrameRateLogger.beginScroll();
    this.props.onScrollBeginDrag && this.props.onScrollBeginDrag(e);
  },
  scrollResponderHandleScrollEndDrag: function scrollResponderHandleScrollEndDrag(e) {
    var velocity = e.nativeEvent.velocity;
    if (!this.scrollResponderIsAnimating() && (!velocity || velocity.x === 0 && velocity.y === 0)) {
      FrameRateLogger.endScroll();
    }
    this.props.onScrollEndDrag && this.props.onScrollEndDrag(e);
  },
  scrollResponderHandleMomentumScrollBegin: function scrollResponderHandleMomentumScrollBegin(e) {
    this.state.lastMomentumScrollBeginTime = performanceNow();
    this.props.onMomentumScrollBegin && this.props.onMomentumScrollBegin(e);
  },
  scrollResponderHandleMomentumScrollEnd: function scrollResponderHandleMomentumScrollEnd(e) {
    FrameRateLogger.endScroll();
    this.state.lastMomentumScrollEndTime = performanceNow();
    this.props.onMomentumScrollEnd && this.props.onMomentumScrollEnd(e);
  },
  scrollResponderHandleTouchStart: function scrollResponderHandleTouchStart(e) {
    this.state.isTouching = true;
    this.props.onTouchStart && this.props.onTouchStart(e);
  },
  scrollResponderHandleTouchMove: function scrollResponderHandleTouchMove(e) {
    this.props.onTouchMove && this.props.onTouchMove(e);
  },
  scrollResponderIsAnimating: function scrollResponderIsAnimating() {
    var now = performanceNow();
    var timeSinceLastMomentumScrollEnd = now - this.state.lastMomentumScrollEndTime;
    var isAnimating = timeSinceLastMomentumScrollEnd < IS_ANIMATING_TOUCH_START_THRESHOLD_MS || this.state.lastMomentumScrollEndTime < this.state.lastMomentumScrollBeginTime;
    return isAnimating;
  },
  scrollResponderGetScrollableNode: function scrollResponderGetScrollableNode() {
    return this.getScrollableNode ? this.getScrollableNode() : ReactNative.findNodeHandle(this);
  },
  scrollResponderScrollTo: function scrollResponderScrollTo(x, y, animated) {
    if (typeof x === 'number') {
      console.warn('`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.');
    } else {
      var _ref = x || {};
      x = _ref.x;
      y = _ref.y;
      animated = _ref.animated;
    }
    UIManager.dispatchViewManagerCommand(nullthrows(this.scrollResponderGetScrollableNode()), UIManager.getViewManagerConfig('RCTScrollView').Commands.scrollTo, [x || 0, y || 0, animated !== false]);
  },
  scrollResponderScrollToEnd: function scrollResponderScrollToEnd(options) {
    var animated = (options && options.animated) !== false;
    UIManager.dispatchViewManagerCommand(this.scrollResponderGetScrollableNode(), UIManager.getViewManagerConfig('RCTScrollView').Commands.scrollToEnd, [animated]);
  },
  scrollResponderScrollWithoutAnimationTo: function scrollResponderScrollWithoutAnimationTo(offsetX, offsetY) {
    console.warn('`scrollResponderScrollWithoutAnimationTo` is deprecated. Use `scrollResponderScrollTo` instead');
    this.scrollResponderScrollTo({
      x: offsetX,
      y: offsetY,
      animated: false
    });
  },
  scrollResponderZoomTo: function scrollResponderZoomTo(rect, animated) {
    invariant(ScrollViewManager && ScrollViewManager.zoomToRect, 'zoomToRect is not implemented');
    if ('animated' in rect) {
      animated = rect.animated;
      delete rect.animated;
    } else if (typeof animated !== 'undefined') {
      console.warn('`scrollResponderZoomTo` `animated` argument is deprecated. Use `options.animated` instead');
    }
    ScrollViewManager.zoomToRect(this.scrollResponderGetScrollableNode(), rect, animated !== false);
  },
  scrollResponderFlashScrollIndicators: function scrollResponderFlashScrollIndicators() {
    UIManager.dispatchViewManagerCommand(this.scrollResponderGetScrollableNode(), UIManager.getViewManagerConfig('RCTScrollView').Commands.flashScrollIndicators, []);
  },
  scrollResponderScrollNativeHandleToKeyboard: function scrollResponderScrollNativeHandleToKeyboard(nodeHandle, additionalOffset, preventNegativeScrollOffset) {
    this.additionalScrollOffset = additionalOffset || 0;
    this.preventNegativeScrollOffset = !!preventNegativeScrollOffset;
    UIManager.measureLayout(nodeHandle, ReactNative.findNodeHandle(this.getInnerViewNode()), this.scrollResponderTextInputFocusError, this.scrollResponderInputMeasureAndScrollToKeyboard);
  },
  scrollResponderInputMeasureAndScrollToKeyboard: function scrollResponderInputMeasureAndScrollToKeyboard(left, top, width, height) {
    var keyboardScreenY = Dimensions.get('window').height;
    if (this.keyboardWillOpenTo) {
      keyboardScreenY = this.keyboardWillOpenTo.endCoordinates.screenY;
    }
    var scrollOffsetY = top - keyboardScreenY + height + this.additionalScrollOffset;
    if (this.preventNegativeScrollOffset) {
      scrollOffsetY = Math.max(0, scrollOffsetY);
    }
    this.scrollResponderScrollTo({
      x: 0,
      y: scrollOffsetY,
      animated: true
    });
    this.additionalOffset = 0;
    this.preventNegativeScrollOffset = false;
  },
  scrollResponderTextInputFocusError: function scrollResponderTextInputFocusError(msg) {
    console.error('Error measuring text field: ', msg);
  },
  UNSAFE_componentWillMount: function UNSAFE_componentWillMount() {
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    warning(typeof keyboardShouldPersistTaps !== 'boolean', "'keyboardShouldPersistTaps={" + keyboardShouldPersistTaps + "}' is deprecated. " + ("Use 'keyboardShouldPersistTaps=\"" + (keyboardShouldPersistTaps ? 'always' : 'never') + "\"' instead"));
    this.keyboardWillOpenTo = null;
    this.additionalScrollOffset = 0;
    this._subscriptionKeyboardWillShow = Keyboard.addListener('keyboardWillShow', this.scrollResponderKeyboardWillShow);
    this._subscriptionKeyboardWillHide = Keyboard.addListener('keyboardWillHide', this.scrollResponderKeyboardWillHide);
    this._subscriptionKeyboardDidShow = Keyboard.addListener('keyboardDidShow', this.scrollResponderKeyboardDidShow);
    this._subscriptionKeyboardDidHide = Keyboard.addListener('keyboardDidHide', this.scrollResponderKeyboardDidHide);
  },
  componentWillUnmount: function componentWillUnmount() {
    if (this._subscriptionKeyboardWillShow != null) {
      this._subscriptionKeyboardWillShow.remove();
    }
    if (this._subscriptionKeyboardWillHide != null) {
      this._subscriptionKeyboardWillHide.remove();
    }
    if (this._subscriptionKeyboardDidShow != null) {
      this._subscriptionKeyboardDidShow.remove();
    }
    if (this._subscriptionKeyboardDidHide != null) {
      this._subscriptionKeyboardDidHide.remove();
    }
  },
  scrollResponderKeyboardWillShow: function scrollResponderKeyboardWillShow(e) {
    this.keyboardWillOpenTo = e;
    this.props.onKeyboardWillShow && this.props.onKeyboardWillShow(e);
  },
  scrollResponderKeyboardWillHide: function scrollResponderKeyboardWillHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardWillHide && this.props.onKeyboardWillHide(e);
  },
  scrollResponderKeyboardDidShow: function scrollResponderKeyboardDidShow(e) {
    if (e) {
      this.keyboardWillOpenTo = e;
    }
    this.props.onKeyboardDidShow && this.props.onKeyboardDidShow(e);
  },
  scrollResponderKeyboardDidHide: function scrollResponderKeyboardDidHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardDidHide && this.props.onKeyboardDidHide(e);
  }
};
var ScrollResponder = {
  Mixin: ScrollResponderMixin
};
module.exports = ScrollResponder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb25zIiwicmVxdWlyZSIsIkZyYW1lUmF0ZUxvZ2dlciIsIktleWJvYXJkIiwiUmVhY3ROYXRpdmUiLCJUZXh0SW5wdXRTdGF0ZSIsIlVJTWFuYWdlciIsImludmFyaWFudCIsIm51bGx0aHJvd3MiLCJwZXJmb3JtYW5jZU5vdyIsIndhcm5pbmciLCJfcmVxdWlyZSIsIlNjcm9sbFZpZXdNYW5hZ2VyIiwiSVNfQU5JTUFUSU5HX1RPVUNIX1NUQVJUX1RIUkVTSE9MRF9NUyIsIlNjcm9sbFJlc3BvbmRlck1peGluIiwiX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3ciLCJfc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZSIsIl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3ciLCJfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlIiwic2Nyb2xsUmVzcG9uZGVyTWl4aW5HZXRJbml0aWFsU3RhdGUiLCJpc1RvdWNoaW5nIiwibGFzdE1vbWVudHVtU2Nyb2xsQmVnaW5UaW1lIiwibGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZSIsIm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlciIsImJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsU2hvdWxkU2V0UmVzcG9uZGVyIiwicHJvcHMiLCJkaXNhYmxlU2Nyb2xsVmlld1BhblJlc3BvbmRlciIsInN0YXRlIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU3RhcnRTaG91bGRTZXRSZXNwb25kZXIiLCJlIiwiY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCIsImN1cnJlbnRseUZvY3VzZWRGaWVsZCIsImtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMiLCJ0YXJnZXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJzY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZyIsImtleWJvYXJkTmV2ZXJQZXJzaXN0VGFwcyIsImlzVGV4dElucHV0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVqZWN0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVGVybWluYXRpb25SZXF1ZXN0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hFbmQiLCJuYXRpdmVFdmVudCIsInRvdWNoZXMiLCJsZW5ndGgiLCJvblRvdWNoRW5kIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hDYW5jZWwiLCJvblRvdWNoQ2FuY2VsIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVsZWFzZSIsIm9uUmVzcG9uZGVyUmVsZWFzZSIsIm9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWQiLCJibHVyVGV4dElucHV0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsIiwib25TY3JvbGwiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJHcmFudCIsIm9uUmVzcG9uZGVyR3JhbnQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxCZWdpbkRyYWciLCJiZWdpblNjcm9sbCIsIm9uU2Nyb2xsQmVnaW5EcmFnIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsRW5kRHJhZyIsInZlbG9jaXR5IiwieCIsInkiLCJlbmRTY3JvbGwiLCJvblNjcm9sbEVuZERyYWciLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVNb21lbnR1bVNjcm9sbEJlZ2luIiwib25Nb21lbnR1bVNjcm9sbEJlZ2luIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxFbmQiLCJvbk1vbWVudHVtU2Nyb2xsRW5kIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hTdGFydCIsIm9uVG91Y2hTdGFydCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoTW92ZSIsIm9uVG91Y2hNb3ZlIiwibm93IiwidGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kIiwiaXNBbmltYXRpbmciLCJzY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSIsImdldFNjcm9sbGFibGVOb2RlIiwiZmluZE5vZGVIYW5kbGUiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyIsImFuaW1hdGVkIiwiY29uc29sZSIsIndhcm4iLCJfcmVmIiwiZGlzcGF0Y2hWaWV3TWFuYWdlckNvbW1hbmQiLCJnZXRWaWV3TWFuYWdlckNvbmZpZyIsIkNvbW1hbmRzIiwic2Nyb2xsVG8iLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZCIsIm9wdGlvbnMiLCJzY3JvbGxUb0VuZCIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFdpdGhvdXRBbmltYXRpb25UbyIsIm9mZnNldFgiLCJvZmZzZXRZIiwic2Nyb2xsUmVzcG9uZGVyWm9vbVRvIiwicmVjdCIsInpvb21Ub1JlY3QiLCJzY3JvbGxSZXNwb25kZXJGbGFzaFNjcm9sbEluZGljYXRvcnMiLCJmbGFzaFNjcm9sbEluZGljYXRvcnMiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxOYXRpdmVIYW5kbGVUb0tleWJvYXJkIiwibm9kZUhhbmRsZSIsImFkZGl0aW9uYWxPZmZzZXQiLCJwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQiLCJhZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0IiwibWVhc3VyZUxheW91dCIsImdldElubmVyVmlld05vZGUiLCJzY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yIiwic2Nyb2xsUmVzcG9uZGVySW5wdXRNZWFzdXJlQW5kU2Nyb2xsVG9LZXlib2FyZCIsImxlZnQiLCJ0b3AiLCJ3aWR0aCIsImhlaWdodCIsImtleWJvYXJkU2NyZWVuWSIsImdldCIsImtleWJvYXJkV2lsbE9wZW5UbyIsImVuZENvb3JkaW5hdGVzIiwic2NyZWVuWSIsInNjcm9sbE9mZnNldFkiLCJNYXRoIiwibWF4IiwibXNnIiwiZXJyb3IiLCJVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50IiwiYWRkTGlzdGVuZXIiLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxTaG93Iiwic2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZSIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkU2hvdyIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlIiwib25LZXlib2FyZFdpbGxTaG93Iiwib25LZXlib2FyZFdpbGxIaWRlIiwib25LZXlib2FyZERpZFNob3ciLCJvbktleWJvYXJkRGlkSGlkZSIsIlNjcm9sbFJlc3BvbmRlciIsIk1peGluIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlNjcm9sbFJlc3BvbmRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBEaW1lbnNpb25zID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL0RpbWVuc2lvbnMnKTtcbmNvbnN0IEZyYW1lUmF0ZUxvZ2dlciA9IHJlcXVpcmUoJy4uL0ludGVyYWN0aW9uL0ZyYW1lUmF0ZUxvZ2dlcicpO1xuY29uc3QgS2V5Ym9hcmQgPSByZXF1aXJlKCcuL0tleWJvYXJkL0tleWJvYXJkJyk7XG5jb25zdCBSZWFjdE5hdGl2ZSA9IHJlcXVpcmUoJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlJyk7XG5jb25zdCBUZXh0SW5wdXRTdGF0ZSA9IHJlcXVpcmUoJy4vVGV4dElucHV0L1RleHRJbnB1dFN0YXRlJyk7XG5jb25zdCBVSU1hbmFnZXIgPSByZXF1aXJlKCcuLi9SZWFjdE5hdGl2ZS9VSU1hbmFnZXInKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCBudWxsdGhyb3dzID0gcmVxdWlyZSgnbnVsbHRocm93cycpO1xuY29uc3QgcGVyZm9ybWFuY2VOb3cgPSByZXF1aXJlKCdmYmpzL2xpYi9wZXJmb3JtYW5jZU5vdycpO1xuY29uc3Qgd2FybmluZyA9IHJlcXVpcmUoJ2ZianMvbGliL3dhcm5pbmcnKTtcblxuY29uc3Qge1Njcm9sbFZpZXdNYW5hZ2VyfSA9IHJlcXVpcmUoJy4uL0JhdGNoZWRCcmlkZ2UvTmF0aXZlTW9kdWxlcycpO1xuXG5pbXBvcnQgdHlwZSB7UHJlc3NFdmVudCwgU2Nyb2xsRXZlbnR9IGZyb20gJy4uL1R5cGVzL0NvcmVFdmVudFR5cGVzJztcbmltcG9ydCB0eXBlIHtLZXlib2FyZEV2ZW50fSBmcm9tICcuL0tleWJvYXJkL0tleWJvYXJkJztcbmltcG9ydCB0eXBlIEVtaXR0ZXJTdWJzY3JpcHRpb24gZnJvbSAnLi4vdmVuZG9yL2VtaXR0ZXIvRW1pdHRlclN1YnNjcmlwdGlvbic7XG5cbi8qKlxuICogTWl4aW4gdGhhdCBjYW4gYmUgaW50ZWdyYXRlZCBpbiBvcmRlciB0byBoYW5kbGUgc2Nyb2xsaW5nIHRoYXQgcGxheXMgd2VsbFxuICogd2l0aCBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLiBJbnRlZ3JhdGUgd2l0aCB5b3VyIHBsYXRmb3JtIHNwZWNpZmljIHNjcm9sbFxuICogdmlld3MsIG9yIGV2ZW4geW91ciBjdXN0b20gYnVpbHQgKGV2ZXJ5LWZyYW1lIGFuaW1hdGluZykgc2Nyb2xsIHZpZXdzIHNvIHRoYXRcbiAqIGFsbCBvZiB0aGVzZSBzeXN0ZW1zIHBsYXkgd2VsbCB3aXRoIHRoZSBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLlxuICpcbiAqIGlPUyBzY3JvbGwgZXZlbnQgdGltaW5nIG51YW5jZXM6XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKlxuICpcbiAqIFNjcm9sbGluZyB3aXRob3V0IGJvdW5jaW5nLCBpZiB5b3UgdG91Y2ggZG93bjpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqXG4gKiAxLiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCAod2hlbiBhbmltYXRpb24gYmVnaW5zIGFmdGVyIGxldHRpbmcgdXApXG4gKiAgICAuLi4gcGh5c2ljYWwgdG91Y2ggc3RhcnRzIC4uLlxuICogMi4gYG9uVG91Y2hTdGFydENhcHR1cmVgICAgKHdoZW4geW91IHByZXNzIGRvd24gdG8gc3RvcCB0aGUgc2Nyb2xsKVxuICogMy4gYG9uVG91Y2hTdGFydGAgICAgICAgICAgKHNhbWUsIGJ1dCBidWJibGUgcGhhc2UpXG4gKiA0LiBgb25SZXNwb25kZXJSZWxlYXNlYCAgICAod2hlbiBsaWZ0aW5nIHVwIC0geW91IGNvdWxkIHBhdXNlIGZvcmV2ZXIgYmVmb3JlICogbGlmdGluZylcbiAqIDUuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYFxuICpcbiAqXG4gKiBTY3JvbGxpbmcgd2l0aCBib3VuY2luZywgaWYgeW91IHRvdWNoIGRvd246XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKlxuICogMS4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKHdoZW4gYW5pbWF0aW9uIGJlZ2lucyBhZnRlciBsZXR0aW5nIHVwKVxuICogICAgLi4uIGJvdW5jZSBiZWdpbnMgLi4uXG4gKiAgICAuLi4gc29tZSB0aW1lIGVsYXBzZXMgLi4uXG4gKiAgICAuLi4gcGh5c2ljYWwgdG91Y2ggZHVyaW5nIGJvdW5jZSAuLi5cbiAqIDIuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYCAgIChNYWtlcyBubyBzZW5zZSB3aHkgdGhpcyBvY2N1cnMgZmlyc3QgZHVyaW5nIGJvdW5jZSlcbiAqIDMuIGBvblRvdWNoU3RhcnRDYXB0dXJlYCAgIChpbW1lZGlhdGVseSBhZnRlciBgb25Nb21lbnR1bVNjcm9sbEVuZGApXG4gKiA0LiBgb25Ub3VjaFN0YXJ0YCAgICAgICAgICAoc2FtZSwgYnV0IGJ1YmJsZSBwaGFzZSlcbiAqIDUuIGBvblRvdWNoRW5kYCAgICAgICAgICAgIChZb3UgY291bGQgaG9sZCB0aGUgdG91Y2ggc3RhcnQgZm9yIGEgbG9uZyB0aW1lKVxuICogNi4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKFdoZW4gcmVsZWFzaW5nIHRoZSB2aWV3IHN0YXJ0cyBib3VuY2luZyBiYWNrKVxuICpcbiAqIFNvIHdoZW4gd2UgcmVjZWl2ZSBhbiBgb25Ub3VjaFN0YXJ0YCwgaG93IGNhbiB3ZSB0ZWxsIGlmIHdlIGFyZSB0b3VjaGluZ1xuICogKmR1cmluZyogYW4gYW5pbWF0aW9uICh3aGljaCB0aGVuIGNhdXNlcyB0aGUgYW5pbWF0aW9uIHRvIHN0b3ApPyBUaGUgb25seSB3YXlcbiAqIHRvIHRlbGwgaXMgaWYgdGhlIGB0b3VjaFN0YXJ0YCBvY2N1cnJlZCBpbW1lZGlhdGVseSBhZnRlciB0aGVcbiAqIGBvbk1vbWVudHVtU2Nyb2xsRW5kYC5cbiAqXG4gKiBUaGlzIGlzIGFic3RyYWN0ZWQgb3V0IGZvciB5b3UsIHNvIHlvdSBjYW4ganVzdCBjYWxsIHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKSBpZlxuICogbmVjZXNzYXJ5XG4gKlxuICogYFNjcm9sbFJlc3BvbmRlcmAgYWxzbyBpbmNsdWRlcyBsb2dpYyBmb3IgYmx1cnJpbmcgYSBjdXJyZW50bHkgZm9jdXNlZCBpbnB1dFxuICogaWYgb25lIGlzIGZvY3VzZWQgd2hpbGUgc2Nyb2xsaW5nLiBUaGUgYFNjcm9sbFJlc3BvbmRlcmAgaXMgYSBuYXR1cmFsIHBsYWNlXG4gKiB0byBwdXQgdGhpcyBsb2dpYyBzaW5jZSBpdCBjYW4gc3VwcG9ydCBub3QgZGlzbWlzc2luZyB0aGUga2V5Ym9hcmQgd2hpbGVcbiAqIHNjcm9sbGluZywgdW5sZXNzIGEgcmVjb2duaXplZCBcInRhcFwiLWxpa2UgZ2VzdHVyZSBoYXMgb2NjdXJyZWQuXG4gKlxuICogVGhlIHB1YmxpYyBsaWZlY3ljbGUgQVBJIGluY2x1ZGVzIGV2ZW50cyBmb3Iga2V5Ym9hcmQgaW50ZXJhY3Rpb24sIHJlc3BvbmRlclxuICogaW50ZXJhY3Rpb24sIGFuZCBzY3JvbGxpbmcgKGFtb25nIG90aGVycykuIFRoZSBrZXlib2FyZCBjYWxsYmFja3NcbiAqIGBvbktleWJvYXJkV2lsbC9EaWQvKmAgYXJlICpnbG9iYWwqIGV2ZW50cywgYnV0IGFyZSBpbnZva2VkIG9uIHNjcm9sbFxuICogcmVzcG9uZGVyJ3MgcHJvcHMgc28gdGhhdCB5b3UgY2FuIGd1YXJhbnRlZSB0aGF0IHRoZSBzY3JvbGwgcmVzcG9uZGVyJ3NcbiAqIGludGVybmFsIHN0YXRlIGhhcyBiZWVuIHVwZGF0ZWQgYWNjb3JkaW5nbHkgKGFuZCBkZXRlcm1pbmlzdGljYWxseSkgYnlcbiAqIHRoZSB0aW1lIHRoZSBwcm9wcyBjYWxsYmFja3MgYXJlIGludm9rZS4gT3RoZXJ3aXNlLCB5b3Ugd291bGQgYWx3YXlzIHdvbmRlclxuICogaWYgdGhlIHNjcm9sbCByZXNwb25kZXIgaXMgY3VycmVudGx5IGluIGEgc3RhdGUgd2hlcmUgaXQgcmVjb2duaXplcyBuZXdcbiAqIGtleWJvYXJkIHBvc2l0aW9ucyBldGMuIElmIGNvb3JkaW5hdGluZyBzY3JvbGxpbmcgd2l0aCBrZXlib2FyZCBtb3ZlbWVudCxcbiAqICphbHdheXMqIHVzZSB0aGVzZSBob29rcyBpbnN0ZWFkIG9mIGxpc3RlbmluZyB0byB5b3VyIG93biBnbG9iYWwga2V5Ym9hcmRcbiAqIGV2ZW50cy5cbiAqXG4gKiBQdWJsaWMga2V5Ym9hcmQgbGlmZWN5Y2xlIEFQSTogKHByb3BzIGNhbGxiYWNrcylcbiAqXG4gKiBTdGFuZGFyZCBLZXlib2FyZCBBcHBlYXJhbmNlIFNlcXVlbmNlOlxuICpcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3dcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkU2hvd1xuICpcbiAqIGBvblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkYCB3aWxsIGJlIGludm9rZWQgaWYgYW4gYXBwcm9wcmlhdGVcbiAqIHRhcCBpbnNpZGUgdGhlIHNjcm9sbCByZXNwb25kZXIncyBzY3JvbGxhYmxlIHJlZ2lvbiB3YXMgcmVzcG9uc2libGVcbiAqIGZvciB0aGUgZGlzbWlzc2FsIG9mIHRoZSBrZXlib2FyZC4gVGhlcmUgYXJlIG90aGVyIHJlYXNvbnMgd2h5IHRoZVxuICoga2V5Ym9hcmQgY291bGQgYmUgZGlzbWlzc2VkLlxuICpcbiAqICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkXG4gKlxuICogU3RhbmRhcmQgS2V5Ym9hcmQgSGlkZSBTZXF1ZW5jZTpcbiAqXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGVcbiAqL1xuXG5jb25zdCBJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TID0gMTY7XG5cbmV4cG9ydCB0eXBlIFN0YXRlID0ge3xcbiAgaXNUb3VjaGluZzogYm9vbGVhbixcbiAgbGFzdE1vbWVudHVtU2Nyb2xsQmVnaW5UaW1lOiBudW1iZXIsXG4gIGxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU6IG51bWJlcixcbiAgb2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyOiBib29sZWFuLFxuICBiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZzogYm9vbGVhbixcbnx9O1xuXG5jb25zdCBTY3JvbGxSZXNwb25kZXJNaXhpbiA9IHtcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3c6IChudWxsOiA/RW1pdHRlclN1YnNjcmlwdGlvbiksXG4gIF9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlOiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93OiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlOiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBzY3JvbGxSZXNwb25kZXJNaXhpbkdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKTogU3RhdGUge1xuICAgIHJldHVybiB7XG4gICAgICBpc1RvdWNoaW5nOiBmYWxzZSxcbiAgICAgIGxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTogMCxcbiAgICAgIGxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU6IDAsXG5cbiAgICAgIC8vIFJlc2V0IHRvIGZhbHNlIGV2ZXJ5IHRpbWUgYmVjb21lcyByZXNwb25kZXIuIFRoaXMgaXMgdXNlZCB0bzpcbiAgICAgIC8vIC0gRGV0ZXJtaW5lIGlmIHRoZSBzY3JvbGwgdmlldyBoYXMgYmVlbiBzY3JvbGxlZCBhbmQgdGhlcmVmb3JlIHNob3VsZFxuICAgICAgLy8gcmVmdXNlIHRvIGdpdmUgdXAgaXRzIHJlc3BvbmRlciBsb2NrLlxuICAgICAgLy8gLSBEZXRlcm1pbmUgaWYgcmVsZWFzaW5nIHNob3VsZCBkaXNtaXNzIHRoZSBrZXlib2FyZCB3aGVuIHdlIGFyZSBpblxuICAgICAgLy8gdGFwLXRvLWRpc21pc3MgbW9kZSAodGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYWx3YXlzJykuXG4gICAgICBvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXI6IGZhbHNlLFxuICAgICAgYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmc6IGZhbHNlLFxuICAgIH07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlcjogZnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgLy8gQWxsb3cgYW55IGV2ZW50IHRvdWNoIHBhc3MgdGhyb3VnaCBpZiB0aGUgZGVmYXVsdCBwYW4gcmVzcG9uZGVyIGlzIGRpc2FibGVkXG4gICAgaWYgKHRoaXMucHJvcHMuZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuaXNUb3VjaGluZztcbiAgfSxcblxuICAvKipcbiAgICogTWVyZWx5IHRvdWNoIHN0YXJ0aW5nIGlzIG5vdCBzdWZmaWNpZW50IGZvciBhIHNjcm9sbCB2aWV3IHRvIGJlY29tZSB0aGVcbiAgICogcmVzcG9uZGVyLiBCZWluZyB0aGUgXCJyZXNwb25kZXJcIiBtZWFucyB0aGF0IHRoZSB2ZXJ5IG5leHQgdG91Y2ggbW92ZS9lbmRcbiAgICogZXZlbnQgd2lsbCByZXN1bHQgaW4gYW4gYWN0aW9uL21vdmVtZW50LlxuICAgKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYCBldmVudC5cbiAgICpcbiAgICogYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJgIGlzIHVzZWQgd2hlbiB0aGUgbmV4dCBtb3ZlL2VuZCB3aWxsIHRyaWdnZXJcbiAgICogc29tZSBVSSBtb3ZlbWVudC9hY3Rpb24sIGJ1dCB3aGVuIHlvdSB3YW50IHRvIHlpZWxkIHByaW9yaXR5IHRvIHZpZXdzXG4gICAqIG5lc3RlZCBpbnNpZGUgb2YgdGhlIHZpZXcuXG4gICAqXG4gICAqIFRoZXJlIG1heSBiZSBzb21lIGNhc2VzIHdoZXJlIHNjcm9sbCB2aWV3cyBhY3R1YWxseSBzaG91bGQgcmV0dXJuIGB0cnVlYFxuICAgKiBmcm9tIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYDogQW55IHRpbWUgd2UgYXJlIGRldGVjdGluZyBhIHN0YW5kYXJkIHRhcFxuICAgKiB0aGF0IGdpdmVzIHByaW9yaXR5IHRvIG5lc3RlZCB2aWV3cy5cbiAgICpcbiAgICogLSBJZiBhIHNpbmdsZSB0YXAgb24gdGhlIHNjcm9sbCB2aWV3IHRyaWdnZXJzIGFuIGFjdGlvbiBzdWNoIGFzXG4gICAqICAgcmVjZW50ZXJpbmcgYSBtYXAgc3R5bGUgdmlldyB5ZXQgd2FudHMgdG8gZ2l2ZSBwcmlvcml0eSB0byBpbnRlcmFjdGlvblxuICAgKiAgIHZpZXdzIGluc2lkZSAoc3VjaCBhcyBkcm9wcGVkIHBpbnMgb3IgbGFiZWxzKSwgdGhlbiB3ZSB3b3VsZCByZXR1cm4gdHJ1ZVxuICAgKiAgIGZyb20gdGhpcyBtZXRob2Qgd2hlbiB0aGVyZSBpcyBhIHNpbmdsZSB0b3VjaC5cbiAgICpcbiAgICogLSBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyBjYXNlLCBpZiBhIHR3byBmaW5nZXIgXCJ0YXBcIiBzaG91bGQgdHJpZ2dlciBhXG4gICAqICAgem9vbSwgd2Ugd291bGQgY2hlY2sgdGhlIGB0b3VjaGVzYCBjb3VudCwgYW5kIGlmIGA+PSAyYCwgd2Ugd291bGQgcmV0dXJuXG4gICAqICAgdHJ1ZS5cbiAgICpcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyOiBmdW5jdGlvbihcbiAgICBlOiBQcmVzc0V2ZW50LFxuICApOiBib29sZWFuIHtcbiAgICAvLyBBbGxvdyBhbnkgZXZlbnQgdG91Y2ggcGFzcyB0aHJvdWdoIGlmIHRoZSBkZWZhdWx0IHBhbiByZXNwb25kZXIgaXMgZGlzYWJsZWRcbiAgICBpZiAodGhpcy5wcm9wcy5kaXNhYmxlU2Nyb2xsVmlld1BhblJlc3BvbmRlciA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgPSBUZXh0SW5wdXRTdGF0ZS5jdXJyZW50bHlGb2N1c2VkRmllbGQoKTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gJ2hhbmRsZWQnICYmXG4gICAgICBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ICE9IG51bGwgJiZcbiAgICAgIGUudGFyZ2V0ICE9PSBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0XG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUaGVyZSBhcmUgdGltZXMgd2hlbiB0aGUgc2Nyb2xsIHZpZXcgd2FudHMgdG8gYmVjb21lIHRoZSByZXNwb25kZXJcbiAgICogKG1lYW5pbmcgcmVzcG9uZCB0byB0aGUgbmV4dCBpbW1lZGlhdGUgYHRvdWNoU3RhcnQvdG91Y2hFbmRgKSwgaW4gYSB3YXlcbiAgICogdGhhdCAqZG9lc24ndCogZ2l2ZSBwcmlvcml0eSB0byBuZXN0ZWQgdmlld3MgKGhlbmNlIHRoZSBjYXB0dXJlIHBoYXNlKTpcbiAgICpcbiAgICogLSBDdXJyZW50bHkgYW5pbWF0aW5nLlxuICAgKiAtIFRhcHBpbmcgYW55d2hlcmUgdGhhdCBpcyBub3QgYSB0ZXh0IGlucHV0LCB3aGlsZSB0aGUga2V5Ym9hcmQgaXNcbiAgICogICB1cCAod2hpY2ggc2hvdWxkIGRpc21pc3MgdGhlIGtleWJvYXJkKS5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmVgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU3RhcnRTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlOiBmdW5jdGlvbihcbiAgICBlOiBQcmVzc0V2ZW50LFxuICApOiBib29sZWFuIHtcbiAgICAvLyBUaGUgc2Nyb2xsIHZpZXcgc2hvdWxkIHJlY2VpdmUgdGFwcyBpbnN0ZWFkIG9mIGl0cyBkZXNjZW5kYW50cyBpZjpcbiAgICAvLyAqIGl0IGlzIGFscmVhZHkgYW5pbWF0aW5nL2RlY2VsZXJhdGluZ1xuICAgIGlmICh0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIEFsbG93IGFueSBldmVudCB0b3VjaCBwYXNzIHRocm91Z2ggaWYgdGhlIGRlZmF1bHQgcGFuIHJlc3BvbmRlciBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLnByb3BzLmRpc2FibGVTY3JvbGxWaWV3UGFuUmVzcG9uZGVyID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gKiB0aGUga2V5Ym9hcmQgaXMgdXAsIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgaXMgJ25ldmVyJyAodGhlIGRlZmF1bHQpLFxuICAgIC8vIGFuZCBhIG5ldyB0b3VjaCBzdGFydHMgd2l0aCBhIG5vbi10ZXh0aW5wdXQgdGFyZ2V0IChpbiB3aGljaCBjYXNlIHRoZVxuICAgIC8vIGZpcnN0IHRhcCBzaG91bGQgYmUgc2VudCB0byB0aGUgc2Nyb2xsIHZpZXcgYW5kIGRpc21pc3MgdGhlIGtleWJvYXJkLFxuICAgIC8vIHRoZW4gdGhlIHNlY29uZCB0YXAgZ29lcyB0byB0aGUgYWN0dWFsIGludGVyaW9yIHZpZXcpXG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRGaWVsZCgpO1xuICAgIGNvbnN0IHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qga2V5Ym9hcmROZXZlclBlcnNpc3RUYXBzID1cbiAgICAgICFrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzIHx8IGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICduZXZlcic7XG4gICAgaWYgKFxuICAgICAga2V5Ym9hcmROZXZlclBlcnNpc3RUYXBzICYmXG4gICAgICBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ICE9IG51bGwgJiZcbiAgICAgIGUudGFyZ2V0ICYmXG4gICAgICAhVGV4dElucHV0U3RhdGUuaXNUZXh0SW5wdXQoZS50YXJnZXQpXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uUmVzcG9uZGVyUmVqZWN0YCBldmVudC5cbiAgICpcbiAgICogU29tZSBvdGhlciBlbGVtZW50IGlzIG5vdCB5aWVsZGluZyBpdHMgcm9sZSBhcyByZXNwb25kZXIuIE5vcm1hbGx5LCB3ZSdkXG4gICAqIGp1c3QgZGlzYWJsZSB0aGUgYFVJU2Nyb2xsVmlld2AsIGJ1dCBhIHRvdWNoIGhhcyBhbHJlYWR5IGJlZ2FuIG9uIGl0LCB0aGVcbiAgICogYFVJU2Nyb2xsVmlld2Agd2lsbCBub3QgYWNjZXB0IGJlaW5nIGRpc2FibGVkIGFmdGVyIHRoYXQuIFRoZSBlYXNpZXN0XG4gICAqIHNvbHV0aW9uIGZvciBub3cgaXMgdG8gYWNjZXB0IHRoZSBsaW1pdGF0aW9uIG9mIGRpc2FsbG93aW5nIHRoaXNcbiAgICogYWx0b2dldGhlci4gVG8gaW1wcm92ZSB0aGlzLCBmaW5kIGEgd2F5IHRvIGRpc2FibGUgdGhlIGBVSVNjcm9sbFZpZXdgIGFmdGVyXG4gICAqIGEgdG91Y2ggaGFzIGFscmVhZHkgc3RhcnRlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlclJlamVjdDogZnVuY3Rpb24oKSB7fSxcblxuICAvKipcbiAgICogV2Ugd2lsbCBhbGxvdyB0aGUgc2Nyb2xsIHZpZXcgdG8gZ2l2ZSB1cCBpdHMgbG9jayBpZmYgaXQgYWNxdWlyZWQgdGhlIGxvY2tcbiAgICogZHVyaW5nIGFuIGFuaW1hdGlvbi4gVGhpcyBpcyBhIHZlcnkgdXNlZnVsIGRlZmF1bHQgdGhhdCBoYXBwZW5zIHRvIHNhdGlzZnlcbiAgICogbWFueSBjb21tb24gdXNlciBleHBlcmllbmNlcy5cbiAgICpcbiAgICogLSBTdG9wIGEgc2Nyb2xsIG9uIHRoZSBsZWZ0IGVkZ2UsIHRoZW4gdHVybiB0aGF0IGludG8gYW4gb3V0ZXIgdmlldydzXG4gICAqICAgYmFja3N3aXBlLlxuICAgKiAtIFN0b3AgYSBzY3JvbGwgbWlkLWJvdW5jZSBhdCB0aGUgdG9wLCBjb250aW51ZSBwdWxsaW5nIHRvIGhhdmUgdGhlIG91dGVyXG4gICAqICAgdmlldyBkaXNtaXNzLlxuICAgKiAtIEhvd2V2ZXIsIHdpdGhvdXQgY2F0Y2hpbmcgdGhlIHNjcm9sbCB2aWV3IG1pZC1ib3VuY2UgKHdoaWxlIGl0IGlzXG4gICAqICAgbW90aW9ubGVzcyksIGlmIHlvdSBkcmFnIGZhciBlbm91Z2ggZm9yIHRoZSBzY3JvbGwgdmlldyB0byBiZWNvbWVcbiAgICogICByZXNwb25kZXIgKGFuZCB0aGVyZWZvcmUgZHJhZyB0aGUgc2Nyb2xsIHZpZXcgYSBiaXQpLCBhbnkgYmFja3N3aXBlXG4gICAqICAgbmF2aWdhdGlvbiBvZiBhIHN3aXBlIGdlc3R1cmUgaGlnaGVyIGluIHRoZSB2aWV3IGhpZXJhcmNoeSwgc2hvdWxkIGJlXG4gICAqICAgcmVqZWN0ZWQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUZXJtaW5hdGlvblJlcXVlc3Q6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXI7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hFbmRgIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgRXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaEVuZDogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIGNvbnN0IG5hdGl2ZUV2ZW50ID0gZS5uYXRpdmVFdmVudDtcbiAgICB0aGlzLnN0YXRlLmlzVG91Y2hpbmcgPSBuYXRpdmVFdmVudC50b3VjaGVzLmxlbmd0aCAhPT0gMDtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hFbmQgJiYgdGhpcy5wcm9wcy5vblRvdWNoRW5kKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblRvdWNoQ2FuY2VsYCBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIHtQcmVzc0V2ZW50fSBlIEV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hDYW5jZWw6IGZ1bmN0aW9uKGU6IFByZXNzRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLmlzVG91Y2hpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hDYW5jZWwgJiYgdGhpcy5wcm9wcy5vblRvdWNoQ2FuY2VsKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblJlc3BvbmRlclJlbGVhc2VgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVsZWFzZTogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMucHJvcHMub25SZXNwb25kZXJSZWxlYXNlICYmIHRoaXMucHJvcHMub25SZXNwb25kZXJSZWxlYXNlKGUpO1xuXG4gICAgLy8gQnkgZGVmYXVsdCBzY3JvbGwgdmlld3Mgd2lsbCB1bmZvY3VzIGEgdGV4dEZpZWxkXG4gICAgLy8gaWYgYW5vdGhlciB0b3VjaCBvY2N1cnMgb3V0c2lkZSBvZiBpdFxuICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgPSBUZXh0SW5wdXRTdGF0ZS5jdXJyZW50bHlGb2N1c2VkRmllbGQoKTtcbiAgICBpZiAoXG4gICAgICB0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgIT09IHRydWUgJiZcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gJ2Fsd2F5cycgJiZcbiAgICAgIGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgIT0gbnVsbCAmJlxuICAgICAgZS50YXJnZXQgIT09IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgJiZcbiAgICAgICF0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlciAmJlxuICAgICAgIXRoaXMuc3RhdGUuYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmdcbiAgICApIHtcbiAgICAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZCAmJlxuICAgICAgICB0aGlzLnByb3BzLm9uU2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaXNtaXNzZWQoZSk7XG4gICAgICBUZXh0SW5wdXRTdGF0ZS5ibHVyVGV4dElucHV0KGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQpO1xuICAgIH1cbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGw6IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIgPSB0cnVlO1xuICAgIHRoaXMucHJvcHMub25TY3JvbGwgJiYgdGhpcy5wcm9wcy5vblNjcm9sbChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJHcmFudGAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJHcmFudDogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlciA9IGZhbHNlO1xuICAgIHRoaXMucHJvcHMub25SZXNwb25kZXJHcmFudCAmJiB0aGlzLnByb3BzLm9uUmVzcG9uZGVyR3JhbnQoZSk7XG4gICAgdGhpcy5zdGF0ZS5iZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyA9IHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKTtcbiAgfSxcblxuICAvKipcbiAgICogVW5mb3J0dW5hdGVseSwgYG9uU2Nyb2xsQmVnaW5EcmFnYCBhbHNvIGZpcmVzIHdoZW4gKnN0b3BwaW5nKiB0aGUgc2Nyb2xsXG4gICAqIGFuaW1hdGlvbiwgYW5kIHRoZXJlJ3Mgbm90IGFuIGVhc3kgd2F5IHRvIGRpc3Rpbmd1aXNoIGEgZHJhZyB2cy4gc3RvcHBpbmdcbiAgICogbW9tZW50dW0uXG4gICAqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsQmVnaW5EcmFnYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEJlZ2luRHJhZzogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICBGcmFtZVJhdGVMb2dnZXIuYmVnaW5TY3JvbGwoKTsgLy8gVE9ETzogdHJhY2sgYWxsIHNjcm9sbHMgYWZ0ZXIgaW1wbGVtZW50aW5nIG9uU2Nyb2xsRW5kQW5pbWF0aW9uXG4gICAgdGhpcy5wcm9wcy5vblNjcm9sbEJlZ2luRHJhZyAmJiB0aGlzLnByb3BzLm9uU2Nyb2xsQmVnaW5EcmFnKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblNjcm9sbEVuZERyYWdgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsRW5kRHJhZzogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICBjb25zdCB7dmVsb2NpdHl9ID0gZS5uYXRpdmVFdmVudDtcbiAgICAvLyAtIElmIHdlIGFyZSBhbmltYXRpbmcsIHRoZW4gdGhpcyBpcyBhIFwiZHJhZ1wiIHRoYXQgaXMgc3RvcHBpbmcgdGhlIHNjcm9sbHZpZXcgYW5kIG1vbWVudHVtIGVuZFxuICAgIC8vICAgd2lsbCBmaXJlLlxuICAgIC8vIC0gSWYgdmVsb2NpdHkgaXMgbm9uLXplcm8sIHRoZW4gdGhlIGludGVyYWN0aW9uIHdpbGwgc3RvcCB3aGVuIG1vbWVudHVtIHNjcm9sbCBlbmRzIG9yXG4gICAgLy8gICBhbm90aGVyIGRyYWcgc3RhcnRzIGFuZCBlbmRzLlxuICAgIC8vIC0gSWYgd2UgZG9uJ3QgZ2V0IHZlbG9jaXR5LCBiZXR0ZXIgdG8gc3RvcCB0aGUgaW50ZXJhY3Rpb24gdHdpY2UgdGhhbiBub3Qgc3RvcCBpdC5cbiAgICBpZiAoXG4gICAgICAhdGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpICYmXG4gICAgICAoIXZlbG9jaXR5IHx8ICh2ZWxvY2l0eS54ID09PSAwICYmIHZlbG9jaXR5LnkgPT09IDApKVxuICAgICkge1xuICAgICAgRnJhbWVSYXRlTG9nZ2VyLmVuZFNjcm9sbCgpO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uU2Nyb2xsRW5kRHJhZyAmJiB0aGlzLnByb3BzLm9uU2Nyb2xsRW5kRHJhZyhlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsQmVnaW46IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5sYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWUgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEJlZ2luICYmIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEJlZ2luKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsRW5kOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIEZyYW1lUmF0ZUxvZ2dlci5lbmRTY3JvbGwoKTtcbiAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEVuZCAmJiB0aGlzLnByb3BzLm9uTW9tZW50dW1TY3JvbGxFbmQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hTdGFydGAgZXZlbnQuXG4gICAqXG4gICAqIFNpbmNlIHdlIGtub3cgdGhhdCB0aGUgYFNpbXBsZUV2ZW50UGx1Z2luYCBvY2N1cnMgbGF0ZXIgaW4gdGhlIHBsdWdpblxuICAgKiBvcmRlciwgYWZ0ZXIgYFJlc3BvbmRlckV2ZW50UGx1Z2luYCwgd2UgY2FuIGRldGVjdCB0aGF0IHdlIHdlcmUgKm5vdCpcbiAgICogcGVybWl0dGVkIHRvIGJlIHRoZSByZXNwb25kZXIgKHByZXN1bWFibHkgYmVjYXVzZSBhIGNvbnRhaW5lZCB2aWV3IGJlY2FtZVxuICAgKiByZXNwb25kZXIpLiBUaGUgYG9uUmVzcG9uZGVyUmVqZWN0YCB3b24ndCBmaXJlIGluIHRoYXQgY2FzZSAtIGl0IG9ubHlcbiAgICogZmlyZXMgd2hlbiBhICpjdXJyZW50KiByZXNwb25kZXIgcmVqZWN0cyBvdXIgcmVxdWVzdC5cbiAgICpcbiAgICogQHBhcmFtIHtQcmVzc0V2ZW50fSBlIFRvdWNoIFN0YXJ0IGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hTdGFydDogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IHRydWU7XG4gICAgdGhpcy5wcm9wcy5vblRvdWNoU3RhcnQgJiYgdGhpcy5wcm9wcy5vblRvdWNoU3RhcnQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hNb3ZlYCBldmVudC5cbiAgICpcbiAgICogU2luY2Ugd2Uga25vdyB0aGF0IHRoZSBgU2ltcGxlRXZlbnRQbHVnaW5gIG9jY3VycyBsYXRlciBpbiB0aGUgcGx1Z2luXG4gICAqIG9yZGVyLCBhZnRlciBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLCB3ZSBjYW4gZGV0ZWN0IHRoYXQgd2Ugd2VyZSAqbm90KlxuICAgKiBwZXJtaXR0ZWQgdG8gYmUgdGhlIHJlc3BvbmRlciAocHJlc3VtYWJseSBiZWNhdXNlIGEgY29udGFpbmVkIHZpZXcgYmVjYW1lXG4gICAqIHJlc3BvbmRlcikuIFRoZSBgb25SZXNwb25kZXJSZWplY3RgIHdvbid0IGZpcmUgaW4gdGhhdCBjYXNlIC0gaXQgb25seVxuICAgKiBmaXJlcyB3aGVuIGEgKmN1cnJlbnQqIHJlc3BvbmRlciByZWplY3RzIG91ciByZXF1ZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgVG91Y2ggU3RhcnQgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaE1vdmU6IGZ1bmN0aW9uKGU6IFByZXNzRXZlbnQpIHtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hNb3ZlICYmIHRoaXMucHJvcHMub25Ub3VjaE1vdmUoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIGZvciB0aGlzIGNsYXNzIHRoYXQgbGV0cyB1cyBxdWlja2x5IGRldGVybWluZSBpZiB0aGVcbiAgICogdmlldyBpcyBjdXJyZW50bHkgYW5pbWF0aW5nLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgdG8ga25vdyB3aGVuXG4gICAqIGEgdG91Y2ggaGFzIGp1c3Qgc3RhcnRlZCBvciBlbmRlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nOiBmdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZU5vdygpO1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RNb21lbnR1bVNjcm9sbEVuZCA9XG4gICAgICBub3cgLSB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU7XG4gICAgY29uc3QgaXNBbmltYXRpbmcgPVxuICAgICAgdGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kIDwgSVNfQU5JTUFUSU5HX1RPVUNIX1NUQVJUX1RIUkVTSE9MRF9NUyB8fFxuICAgICAgdGhpcy5zdGF0ZS5sYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lIDxcbiAgICAgICAgdGhpcy5zdGF0ZS5sYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWU7XG4gICAgcmV0dXJuIGlzQW5pbWF0aW5nO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBub2RlIHRoYXQgcmVwcmVzZW50cyBuYXRpdmUgdmlldyB0aGF0IGNhbiBiZSBzY3JvbGxlZC5cbiAgICogQ29tcG9uZW50cyBjYW4gcGFzcyB3aGF0IG5vZGUgdG8gdXNlIGJ5IGRlZmluaW5nIGEgYGdldFNjcm9sbGFibGVOb2RlYFxuICAgKiBmdW5jdGlvbiBvdGhlcndpc2UgYHRoaXNgIGlzIHVzZWQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZTogZnVuY3Rpb24oKTogP251bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U2Nyb2xsYWJsZU5vZGVcbiAgICAgID8gdGhpcy5nZXRTY3JvbGxhYmxlTm9kZSgpXG4gICAgICA6IFJlYWN0TmF0aXZlLmZpbmROb2RlSGFuZGxlKHRoaXMpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBIGhlbHBlciBmdW5jdGlvbiB0byBzY3JvbGwgdG8gYSBzcGVjaWZpYyBwb2ludCBpbiB0aGUgU2Nyb2xsVmlldy5cbiAgICogVGhpcyBpcyBjdXJyZW50bHkgdXNlZCB0byBoZWxwIGZvY3VzIGNoaWxkIFRleHRWaWV3cywgYnV0IGNhbiBhbHNvXG4gICAqIGJlIHVzZWQgdG8gcXVpY2tseSBzY3JvbGwgdG8gYW55IGVsZW1lbnQgd2Ugd2FudCB0byBmb2N1cy4gU3ludGF4OlxuICAgKlxuICAgKiBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8ob3B0aW9uczoge3g6IG51bWJlciA9IDA7IHk6IG51bWJlciA9IDA7IGFuaW1hdGVkOiBib29sZWFuID0gdHJ1ZX0pYFxuICAgKlxuICAgKiBOb3RlOiBUaGUgd2VpcmQgYXJndW1lbnQgc2lnbmF0dXJlIGlzIGR1ZSB0byB0aGUgZmFjdCB0aGF0LCBmb3IgaGlzdG9yaWNhbCByZWFzb25zLFxuICAgKiB0aGUgZnVuY3Rpb24gYWxzbyBhY2NlcHRzIHNlcGFyYXRlIGFyZ3VtZW50cyBhcyBhcyBhbHRlcm5hdGl2ZSB0byB0aGUgb3B0aW9ucyBvYmplY3QuXG4gICAqIFRoaXMgaXMgZGVwcmVjYXRlZCBkdWUgdG8gYW1iaWd1aXR5ICh5IGJlZm9yZSB4KSwgYW5kIFNIT1VMRCBOT1QgQkUgVVNFRC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvOiBmdW5jdGlvbihcbiAgICB4PzogbnVtYmVyIHwge3g/OiBudW1iZXIsIHk/OiBudW1iZXIsIGFuaW1hdGVkPzogYm9vbGVhbn0sXG4gICAgeT86IG51bWJlcixcbiAgICBhbmltYXRlZD86IGJvb2xlYW4sXG4gICkge1xuICAgIGlmICh0eXBlb2YgeCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ2BzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh4LCB5LCBhbmltYXRlZClgIGlzIGRlcHJlY2F0ZWQuIFVzZSBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IDUsIHk6IDUsIGFuaW1hdGVkOiB0cnVlfSlgIGluc3RlYWQuJyxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICh7eCwgeSwgYW5pbWF0ZWR9ID0geCB8fCB7fSk7XG4gICAgfVxuICAgIFVJTWFuYWdlci5kaXNwYXRjaFZpZXdNYW5hZ2VyQ29tbWFuZChcbiAgICAgIG51bGx0aHJvd3ModGhpcy5zY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSgpKSxcbiAgICAgIFVJTWFuYWdlci5nZXRWaWV3TWFuYWdlckNvbmZpZygnUkNUU2Nyb2xsVmlldycpLkNvbW1hbmRzLnNjcm9sbFRvLFxuICAgICAgW3ggfHwgMCwgeSB8fCAwLCBhbmltYXRlZCAhPT0gZmFsc2VdLFxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNjcm9sbHMgdG8gdGhlIGVuZCBvZiB0aGUgU2Nyb2xsVmlldywgZWl0aGVyIGltbWVkaWF0ZWx5IG9yIHdpdGggYSBzbW9vdGhcbiAgICogYW5pbWF0aW9uLlxuICAgKlxuICAgKiBFeGFtcGxlOlxuICAgKlxuICAgKiBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG9FbmQoe2FuaW1hdGVkOiB0cnVlfSlgXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZDogZnVuY3Rpb24ob3B0aW9ucz86IHthbmltYXRlZD86IGJvb2xlYW59KSB7XG4gICAgLy8gRGVmYXVsdCB0byB0cnVlXG4gICAgY29uc3QgYW5pbWF0ZWQgPSAob3B0aW9ucyAmJiBvcHRpb25zLmFuaW1hdGVkKSAhPT0gZmFsc2U7XG4gICAgVUlNYW5hZ2VyLmRpc3BhdGNoVmlld01hbmFnZXJDb21tYW5kKFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSgpLFxuICAgICAgVUlNYW5hZ2VyLmdldFZpZXdNYW5hZ2VyQ29uZmlnKCdSQ1RTY3JvbGxWaWV3JykuQ29tbWFuZHMuc2Nyb2xsVG9FbmQsXG4gICAgICBbYW5pbWF0ZWRdLFxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERlcHJlY2F0ZWQsIGRvIG5vdCB1c2UuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJTY3JvbGxXaXRob3V0QW5pbWF0aW9uVG86IGZ1bmN0aW9uKFxuICAgIG9mZnNldFg6IG51bWJlcixcbiAgICBvZmZzZXRZOiBudW1iZXIsXG4gICkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICdgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsV2l0aG91dEFuaW1hdGlvblRvYCBpcyBkZXByZWNhdGVkLiBVc2UgYHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvYCBpbnN0ZWFkJyxcbiAgICApO1xuICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IG9mZnNldFgsIHk6IG9mZnNldFksIGFuaW1hdGVkOiBmYWxzZX0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBIGhlbHBlciBmdW5jdGlvbiB0byB6b29tIHRvIGEgc3BlY2lmaWMgcmVjdCBpbiB0aGUgc2Nyb2xsdmlldy4gVGhlIGFyZ3VtZW50IGhhcyB0aGUgc2hhcGVcbiAgICoge3g6IG51bWJlcjsgeTogbnVtYmVyOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlcjsgYW5pbWF0ZWQ6IGJvb2xlYW4gPSB0cnVlfVxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJab29tVG86IGZ1bmN0aW9uKFxuICAgIHJlY3Q6IHt8XG4gICAgICB4OiBudW1iZXIsXG4gICAgICB5OiBudW1iZXIsXG4gICAgICB3aWR0aDogbnVtYmVyLFxuICAgICAgaGVpZ2h0OiBudW1iZXIsXG4gICAgICBhbmltYXRlZD86IGJvb2xlYW4sXG4gICAgfH0sXG4gICAgYW5pbWF0ZWQ/OiBib29sZWFuLCAvLyBkZXByZWNhdGVkLCBwdXQgdGhpcyBpbnNpZGUgdGhlIHJlY3QgYXJndW1lbnQgaW5zdGVhZFxuICApIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBTY3JvbGxWaWV3TWFuYWdlciAmJiBTY3JvbGxWaWV3TWFuYWdlci56b29tVG9SZWN0LFxuICAgICAgJ3pvb21Ub1JlY3QgaXMgbm90IGltcGxlbWVudGVkJyxcbiAgICApO1xuICAgIGlmICgnYW5pbWF0ZWQnIGluIHJlY3QpIHtcbiAgICAgIGFuaW1hdGVkID0gcmVjdC5hbmltYXRlZDtcbiAgICAgIGRlbGV0ZSByZWN0LmFuaW1hdGVkO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGFuaW1hdGVkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnYHNjcm9sbFJlc3BvbmRlclpvb21Ub2AgYGFuaW1hdGVkYCBhcmd1bWVudCBpcyBkZXByZWNhdGVkLiBVc2UgYG9wdGlvbnMuYW5pbWF0ZWRgIGluc3RlYWQnLFxuICAgICAgKTtcbiAgICB9XG4gICAgU2Nyb2xsVmlld01hbmFnZXIuem9vbVRvUmVjdChcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyR2V0U2Nyb2xsYWJsZU5vZGUoKSxcbiAgICAgIHJlY3QsXG4gICAgICBhbmltYXRlZCAhPT0gZmFsc2UsXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogRGlzcGxheXMgdGhlIHNjcm9sbCBpbmRpY2F0b3JzIG1vbWVudGFyaWx5LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyRmxhc2hTY3JvbGxJbmRpY2F0b3JzOiBmdW5jdGlvbigpIHtcbiAgICBVSU1hbmFnZXIuZGlzcGF0Y2hWaWV3TWFuYWdlckNvbW1hbmQoXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlKCksXG4gICAgICBVSU1hbmFnZXIuZ2V0Vmlld01hbmFnZXJDb25maWcoJ1JDVFNjcm9sbFZpZXcnKS5Db21tYW5kc1xuICAgICAgICAuZmxhc2hTY3JvbGxJbmRpY2F0b3JzLFxuICAgICAgW10sXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgYXMgdGhlIGNhbGxiYWNrIHRvIG9uRm9jdXMgaW4gYSBUZXh0SW5wdXRzJ1xuICAgKiBwYXJlbnQgdmlldy4gTm90ZSB0aGF0IGFueSBtb2R1bGUgdXNpbmcgdGhpcyBtaXhpbiBuZWVkcyB0byByZXR1cm5cbiAgICogdGhlIHBhcmVudCB2aWV3J3MgcmVmIGluIGdldFNjcm9sbFZpZXdSZWYoKSBpbiBvcmRlciB0byB1c2UgdGhpcyBtZXRob2QuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBub2RlSGFuZGxlIFRoZSBUZXh0SW5wdXQgbm9kZSBoYW5kbGVcbiAgICogQHBhcmFtIHtudW1iZXJ9IGFkZGl0aW9uYWxPZmZzZXQgVGhlIHNjcm9sbCB2aWV3J3MgYm90dG9tIFwiY29udGVudEluc2V0XCIuXG4gICAqICAgICAgICBEZWZhdWx0IGlzIDAuXG4gICAqIEBwYXJhbSB7Ym9vbH0gcHJldmVudE5lZ2F0aXZlU2Nyb2xsaW5nIFdoZXRoZXIgdG8gYWxsb3cgcHVsbGluZyB0aGUgY29udGVudFxuICAgKiAgICAgICAgZG93biB0byBtYWtlIGl0IG1lZXQgdGhlIGtleWJvYXJkJ3MgdG9wLiBEZWZhdWx0IGlzIGZhbHNlLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsTmF0aXZlSGFuZGxlVG9LZXlib2FyZDogZnVuY3Rpb24oXG4gICAgbm9kZUhhbmRsZTogbnVtYmVyLFxuICAgIGFkZGl0aW9uYWxPZmZzZXQ/OiBudW1iZXIsXG4gICAgcHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0PzogYm9vbGVhbixcbiAgKSB7XG4gICAgdGhpcy5hZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0ID0gYWRkaXRpb25hbE9mZnNldCB8fCAwO1xuICAgIHRoaXMucHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0ID0gISFwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ7XG4gICAgVUlNYW5hZ2VyLm1lYXN1cmVMYXlvdXQoXG4gICAgICBub2RlSGFuZGxlLFxuICAgICAgUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUodGhpcy5nZXRJbm5lclZpZXdOb2RlKCkpLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkLFxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSBjYWxjdWxhdGlvbnMgcGVyZm9ybWVkIGhlcmUgYXNzdW1lIHRoZSBzY3JvbGwgdmlldyB0YWtlcyB1cCB0aGUgZW50aXJlXG4gICAqIHNjcmVlbiAtIGV2ZW4gaWYgaGFzIHNvbWUgY29udGVudCBpbnNldC4gV2UgdGhlbiBtZWFzdXJlIHRoZSBvZmZzZXRzIG9mIHRoZVxuICAgKiBrZXlib2FyZCwgYW5kIGNvbXBlbnNhdGUgYm90aCBmb3IgdGhlIHNjcm9sbCB2aWV3J3MgXCJjb250ZW50SW5zZXRcIi5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgUG9zaXRpb24gb2YgaW5wdXQgdy5yLnQuIHRhYmxlIHZpZXcuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0b3AgUG9zaXRpb24gb2YgaW5wdXQgdy5yLnQuIHRhYmxlIHZpZXcuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCBXaWR0aCBvZiB0aGUgdGV4dCBpbnB1dC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBIZWlnaHQgb2YgdGhlIHRleHQgaW5wdXQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkOiBmdW5jdGlvbihcbiAgICBsZWZ0OiBudW1iZXIsXG4gICAgdG9wOiBudW1iZXIsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgKSB7XG4gICAgbGV0IGtleWJvYXJkU2NyZWVuWSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKS5oZWlnaHQ7XG4gICAgaWYgKHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvKSB7XG4gICAgICBrZXlib2FyZFNjcmVlblkgPSB0aGlzLmtleWJvYXJkV2lsbE9wZW5Uby5lbmRDb29yZGluYXRlcy5zY3JlZW5ZO1xuICAgIH1cbiAgICBsZXQgc2Nyb2xsT2Zmc2V0WSA9XG4gICAgICB0b3AgLSBrZXlib2FyZFNjcmVlblkgKyBoZWlnaHQgKyB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQ7XG5cbiAgICAvLyBCeSBkZWZhdWx0LCB0aGlzIGNhbiBzY3JvbGwgd2l0aCBuZWdhdGl2ZSBvZmZzZXQsIHB1bGxpbmcgdGhlIGNvbnRlbnRcbiAgICAvLyBkb3duIHNvIHRoYXQgdGhlIHRhcmdldCBjb21wb25lbnQncyBib3R0b20gbWVldHMgdGhlIGtleWJvYXJkJ3MgdG9wLlxuICAgIC8vIElmIHJlcXVlc3RlZCBvdGhlcndpc2UsIGNhcCB0aGUgb2Zmc2V0IGF0IDAgbWluaW11bSB0byBhdm9pZCBjb250ZW50XG4gICAgLy8gc2hpZnRpbmcgZG93bi5cbiAgICBpZiAodGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQpIHtcbiAgICAgIHNjcm9sbE9mZnNldFkgPSBNYXRoLm1heCgwLCBzY3JvbGxPZmZzZXRZKTtcbiAgICB9XG4gICAgdGhpcy5zY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh7eDogMCwgeTogc2Nyb2xsT2Zmc2V0WSwgYW5pbWF0ZWQ6IHRydWV9KTtcblxuICAgIHRoaXMuYWRkaXRpb25hbE9mZnNldCA9IDA7XG4gICAgdGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQgPSBmYWxzZTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yOiBmdW5jdGlvbihtc2c6IHN0cmluZykge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1lYXN1cmluZyB0ZXh0IGZpZWxkOiAnLCBtc2cpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBgY29tcG9uZW50V2lsbE1vdW50YCBpcyB0aGUgY2xvc2VzdCB0aGluZyB0byBhICBzdGFuZGFyZCBcImNvbnN0cnVjdG9yXCIgZm9yXG4gICAqIFJlYWN0IGNvbXBvbmVudHMuXG4gICAqXG4gICAqIFRoZSBga2V5Ym9hcmRXaWxsU2hvd2AgaXMgY2FsbGVkIGJlZm9yZSBpbnB1dCBmb2N1cy5cbiAgICovXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfSA9IHRoaXMucHJvcHM7XG4gICAgd2FybmluZyhcbiAgICAgIHR5cGVvZiBrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYm9vbGVhbicsXG4gICAgICBgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9eyR7a2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwc319JyBpcyBkZXByZWNhdGVkLiBgICtcbiAgICAgICAgYFVzZSAna2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcz1cIiR7XG4gICAgICAgICAga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA/ICdhbHdheXMnIDogJ25ldmVyJ1xuICAgICAgICB9XCInIGluc3RlYWRgLFxuICAgICk7XG5cbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IG51bGw7XG4gICAgdGhpcy5hZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0ID0gMDtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmRXaWxsU2hvdycsXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbFNob3csXG4gICAgKTtcblxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZFdpbGxIaWRlJyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZSxcbiAgICApO1xuICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkU2hvdyA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgJ2tleWJvYXJkRGlkU2hvdycsXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkU2hvdyxcbiAgICApO1xuICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZSA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgJ2tleWJvYXJkRGlkSGlkZScsXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZSxcbiAgICApO1xuICB9LFxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50OiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsU2hvdyAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93LnJlbW92ZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlLnJlbW92ZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93ICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkU2hvdy5yZW1vdmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZEhpZGUucmVtb3ZlKCk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBXYXJuaW5nLCB0aGlzIG1heSBiZSBjYWxsZWQgc2V2ZXJhbCB0aW1lcyBmb3IgYSBzaW5nbGUga2V5Ym9hcmQgb3BlbmluZy5cbiAgICogSXQncyBiZXN0IHRvIHN0b3JlIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGlzIG1ldGhvZCBhbmQgdGhlbiB0YWtlIGFueSBhY3Rpb25cbiAgICogYXQgYSBsYXRlciBwb2ludCAoZWl0aGVyIGluIGBrZXlib2FyZERpZFNob3dgIG9yIG90aGVyKS5cbiAgICpcbiAgICogSGVyZSdzIHRoZSBvcmRlciB0aGF0IGV2ZW50cyBvY2N1ciBpbjpcbiAgICogLSBmb2N1c1xuICAgKiAtIHdpbGxTaG93IHtzdGFydENvb3JkaW5hdGVzLCBlbmRDb29yZGluYXRlc30gc2V2ZXJhbCB0aW1lc1xuICAgKiAtIGRpZFNob3cgc2V2ZXJhbCB0aW1lc1xuICAgKiAtIGJsdXJcbiAgICogLSB3aWxsSGlkZSB7c3RhcnRDb29yZGluYXRlcywgZW5kQ29vcmRpbmF0ZXN9IHNldmVyYWwgdGltZXNcbiAgICogLSBkaWRIaWRlIHNldmVyYWwgdGltZXNcbiAgICpcbiAgICogVGhlIGBTY3JvbGxSZXNwb25kZXJgIG1vZHVsZSBjYWxsYmFja3MgZm9yIGVhY2ggb2YgdGhlc2UgZXZlbnRzLlxuICAgKiBFdmVuIHRob3VnaCBhbnkgdXNlciBjb3VsZCBoYXZlIGVhc2lseSBsaXN0ZW5lZCB0byBrZXlib2FyZCBldmVudHNcbiAgICogdGhlbXNlbHZlcywgdXNpbmcgdGhlc2UgYHByb3BzYCBjYWxsYmFja3MgZW5zdXJlcyB0aGF0IG9yZGVyaW5nIG9mIGV2ZW50c1xuICAgKiBpcyBjb25zaXN0ZW50IC0gYW5kIG5vdCBkZXBlbmRlbnQgb24gdGhlIG9yZGVyIHRoYXQgdGhlIGtleWJvYXJkIGV2ZW50cyBhcmVcbiAgICogc3Vic2NyaWJlZCB0by4gVGhpcyBtYXR0ZXJzIHdoZW4gdGVsbGluZyB0aGUgc2Nyb2xsIHZpZXcgdG8gc2Nyb2xsIHRvIHdoZXJlXG4gICAqIHRoZSBrZXlib2FyZCBpcyBoZWFkZWQgLSB0aGUgc2Nyb2xsIHJlc3BvbmRlciBiZXR0ZXIgaGF2ZSBiZWVuIG5vdGlmaWVkIG9mXG4gICAqIHRoZSBrZXlib2FyZCBkZXN0aW5hdGlvbiBiZWZvcmUgYmVpbmcgaW5zdHJ1Y3RlZCB0byBzY3JvbGwgdG8gd2hlcmUgdGhlXG4gICAqIGtleWJvYXJkIHdpbGwgYmUuIFN0aWNrIHRvIHRoZSBgU2Nyb2xsUmVzcG9uZGVyYCBjYWxsYmFja3MsIGFuZCBldmVyeXRoaW5nXG4gICAqIHdpbGwgd29yay5cbiAgICpcbiAgICogV0FSTklORzogVGhlc2UgY2FsbGJhY2tzIHdpbGwgZmlyZSBldmVuIGlmIGEga2V5Ym9hcmQgaXMgZGlzcGxheWVkIGluIGFcbiAgICogZGlmZmVyZW50IG5hdmlnYXRpb24gcGFuZS4gRmlsdGVyIG91dCB0aGUgZXZlbnRzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZVxuICAgKiByZWxldmFudCB0byB5b3UuIChGb3IgZXhhbXBsZSwgb25seSBpZiB5b3UgcmVjZWl2ZSB0aGVzZSBjYWxsYmFja3MgYWZ0ZXJcbiAgICogeW91IGhhZCBleHBsaWNpdGx5IGZvY3VzZWQgYSBub2RlIGV0YykuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxTaG93OiBmdW5jdGlvbihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBlO1xuICAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxTaG93ICYmIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxTaG93KGUpO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGU6IGZ1bmN0aW9uKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IG51bGw7XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbEhpZGUgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbEhpZGUoZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRTaG93OiBmdW5jdGlvbihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgLy8gVE9ETyg3NjkzOTYxKTogVGhlIGV2ZW50IGZvciBEaWRTaG93IGlzIG5vdCBhdmFpbGFibGUgb24gaU9TIHlldC5cbiAgICAvLyBVc2UgdGhlIG9uZSBmcm9tIFdpbGxTaG93IGFuZCBkbyBub3QgYXNzaWduLlxuICAgIGlmIChlKSB7XG4gICAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IGU7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZFNob3cgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkU2hvdyhlKTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZEhpZGU6IGZ1bmN0aW9uKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IG51bGw7XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkSGlkZSAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRIaWRlKGUpO1xuICB9LFxufTtcblxuY29uc3QgU2Nyb2xsUmVzcG9uZGVyID0ge1xuICBNaXhpbjogU2Nyb2xsUmVzcG9uZGVyTWl4aW4sXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjcm9sbFJlc3BvbmRlcjtcbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFFWixJQUFNQSxVQUFVLEdBQUdDLE9B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