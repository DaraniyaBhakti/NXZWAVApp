063daf6b95f9a716d6e03ff0c89c3147
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var invariant = require('invariant');
function elementsThatOverlapOffsets(offsets, itemCount, getFrameMetrics) {
  var out = [];
  var outLength = 0;
  for (var ii = 0; ii < itemCount; ii++) {
    var frame = getFrameMetrics(ii);
    var trailingOffset = frame.offset + frame.length;
    for (var kk = 0; kk < offsets.length; kk++) {
      if (out[kk] == null && trailingOffset >= offsets[kk]) {
        out[kk] = ii;
        outLength++;
        if (kk === offsets.length - 1) {
          invariant(outLength === offsets.length, 'bad offsets input, should be in increasing order: %s', JSON.stringify(offsets));
          return out;
        }
      }
    }
  }
  return out;
}
function newRangeCount(prev, next) {
  return next.last - next.first + 1 - Math.max(0, 1 + Math.min(next.last, prev.last) - Math.max(next.first, prev.first));
}
function computeWindowedRenderLimits(props, prev, getFrameMetricsApprox, scrollMetrics) {
  var data = props.data,
    getItemCount = props.getItemCount,
    maxToRenderPerBatch = props.maxToRenderPerBatch,
    windowSize = props.windowSize;
  var itemCount = getItemCount(data);
  if (itemCount === 0) {
    return prev;
  }
  var offset = scrollMetrics.offset,
    velocity = scrollMetrics.velocity,
    visibleLength = scrollMetrics.visibleLength;
  var visibleBegin = Math.max(0, offset);
  var visibleEnd = visibleBegin + visibleLength;
  var overscanLength = (windowSize - 1) * visibleLength;
  var leadFactor = 0.5;
  var fillPreference = velocity > 1 ? 'after' : velocity < -1 ? 'before' : 'none';
  var overscanBegin = Math.max(0, visibleBegin - (1 - leadFactor) * overscanLength);
  var overscanEnd = Math.max(0, visibleEnd + leadFactor * overscanLength);
  var lastItemOffset = getFrameMetricsApprox(itemCount - 1).offset;
  if (lastItemOffset < overscanBegin) {
    return {
      first: Math.max(0, itemCount - 1 - maxToRenderPerBatch),
      last: itemCount - 1
    };
  }
  var _elementsThatOverlapO = elementsThatOverlapOffsets([overscanBegin, visibleBegin, visibleEnd, overscanEnd], props.getItemCount(props.data), getFrameMetricsApprox),
    _elementsThatOverlapO2 = (0, _slicedToArray2.default)(_elementsThatOverlapO, 4),
    overscanFirst = _elementsThatOverlapO2[0],
    first = _elementsThatOverlapO2[1],
    last = _elementsThatOverlapO2[2],
    overscanLast = _elementsThatOverlapO2[3];
  overscanFirst = overscanFirst == null ? 0 : overscanFirst;
  first = first == null ? Math.max(0, overscanFirst) : first;
  overscanLast = overscanLast == null ? itemCount - 1 : overscanLast;
  last = last == null ? Math.min(overscanLast, first + maxToRenderPerBatch - 1) : last;
  var visible = {
    first: first,
    last: last
  };
  var newCellCount = newRangeCount(prev, visible);
  while (true) {
    if (first <= overscanFirst && last >= overscanLast) {
      break;
    }
    var maxNewCells = newCellCount >= maxToRenderPerBatch;
    var firstWillAddMore = first <= prev.first || first > prev.last;
    var firstShouldIncrement = first > overscanFirst && (!maxNewCells || !firstWillAddMore);
    var lastWillAddMore = last >= prev.last || last < prev.first;
    var lastShouldIncrement = last < overscanLast && (!maxNewCells || !lastWillAddMore);
    if (maxNewCells && !firstShouldIncrement && !lastShouldIncrement) {
      break;
    }
    if (firstShouldIncrement && !(fillPreference === 'after' && lastShouldIncrement && lastWillAddMore)) {
      if (firstWillAddMore) {
        newCellCount++;
      }
      first--;
    }
    if (lastShouldIncrement && !(fillPreference === 'before' && firstShouldIncrement && firstWillAddMore)) {
      if (lastWillAddMore) {
        newCellCount++;
      }
      last++;
    }
  }
  if (!(last >= first && first >= 0 && last < itemCount && first >= overscanFirst && last <= overscanLast && first <= visible.first && last >= visible.last)) {
    throw new Error('Bad window calculation ' + JSON.stringify({
      first: first,
      last: last,
      itemCount: itemCount,
      overscanFirst: overscanFirst,
      overscanLast: overscanLast,
      visible: visible
    }));
  }
  return {
    first: first,
    last: last
  };
}
var VirtualizeUtils = {
  computeWindowedRenderLimits: computeWindowedRenderLimits,
  elementsThatOverlapOffsets: elementsThatOverlapOffsets,
  newRangeCount: newRangeCount
};
module.exports = VirtualizeUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9zbGljZWRUb0FycmF5MiIsImludmFyaWFudCIsImVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzIiwib2Zmc2V0cyIsIml0ZW1Db3VudCIsImdldEZyYW1lTWV0cmljcyIsIm91dCIsIm91dExlbmd0aCIsImlpIiwiZnJhbWUiLCJ0cmFpbGluZ09mZnNldCIsIm9mZnNldCIsImxlbmd0aCIsImtrIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5ld1JhbmdlQ291bnQiLCJwcmV2IiwibmV4dCIsImxhc3QiLCJmaXJzdCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJjb21wdXRlV2luZG93ZWRSZW5kZXJMaW1pdHMiLCJwcm9wcyIsImdldEZyYW1lTWV0cmljc0FwcHJveCIsInNjcm9sbE1ldHJpY3MiLCJkYXRhIiwiZ2V0SXRlbUNvdW50IiwibWF4VG9SZW5kZXJQZXJCYXRjaCIsIndpbmRvd1NpemUiLCJ2ZWxvY2l0eSIsInZpc2libGVMZW5ndGgiLCJ2aXNpYmxlQmVnaW4iLCJ2aXNpYmxlRW5kIiwib3ZlcnNjYW5MZW5ndGgiLCJsZWFkRmFjdG9yIiwiZmlsbFByZWZlcmVuY2UiLCJvdmVyc2NhbkJlZ2luIiwib3ZlcnNjYW5FbmQiLCJsYXN0SXRlbU9mZnNldCIsIl9lbGVtZW50c1RoYXRPdmVybGFwTyIsIl9lbGVtZW50c1RoYXRPdmVybGFwTzIiLCJkZWZhdWx0Iiwib3ZlcnNjYW5GaXJzdCIsIm92ZXJzY2FuTGFzdCIsInZpc2libGUiLCJuZXdDZWxsQ291bnQiLCJtYXhOZXdDZWxscyIsImZpcnN0V2lsbEFkZE1vcmUiLCJmaXJzdFNob3VsZEluY3JlbWVudCIsImxhc3RXaWxsQWRkTW9yZSIsImxhc3RTaG91bGRJbmNyZW1lbnQiLCJFcnJvciIsIlZpcnR1YWxpemVVdGlscyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJWaXJ0dWFsaXplVXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG4vKipcbiAqIFVzZWQgdG8gZmluZCB0aGUgaW5kaWNlcyBvZiB0aGUgZnJhbWVzIHRoYXQgb3ZlcmxhcCB0aGUgZ2l2ZW4gb2Zmc2V0cy4gVXNlZnVsIGZvciBmaW5kaW5nIHRoZVxuICogaXRlbXMgdGhhdCBib3VuZCBkaWZmZXJlbnQgd2luZG93cyBvZiBjb250ZW50LCBzdWNoIGFzIHRoZSB2aXNpYmxlIGFyZWEgb3IgdGhlIGJ1ZmZlcmVkIG92ZXJzY2FuXG4gKiBhcmVhLlxuICovXG5mdW5jdGlvbiBlbGVtZW50c1RoYXRPdmVybGFwT2Zmc2V0cyhcbiAgb2Zmc2V0czogQXJyYXk8bnVtYmVyPixcbiAgaXRlbUNvdW50OiBudW1iZXIsXG4gIGdldEZyYW1lTWV0cmljczogKGluZGV4OiBudW1iZXIpID0+IHtsZW5ndGg6IG51bWJlciwgb2Zmc2V0OiBudW1iZXJ9LFxuKTogQXJyYXk8bnVtYmVyPiB7XG4gIGNvbnN0IG91dCA9IFtdO1xuICBsZXQgb3V0TGVuZ3RoID0gMDtcbiAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGl0ZW1Db3VudDsgaWkrKykge1xuICAgIGNvbnN0IGZyYW1lID0gZ2V0RnJhbWVNZXRyaWNzKGlpKTtcbiAgICBjb25zdCB0cmFpbGluZ09mZnNldCA9IGZyYW1lLm9mZnNldCArIGZyYW1lLmxlbmd0aDtcbiAgICBmb3IgKGxldCBrayA9IDA7IGtrIDwgb2Zmc2V0cy5sZW5ndGg7IGtrKyspIHtcbiAgICAgIGlmIChvdXRba2tdID09IG51bGwgJiYgdHJhaWxpbmdPZmZzZXQgPj0gb2Zmc2V0c1tra10pIHtcbiAgICAgICAgb3V0W2trXSA9IGlpO1xuICAgICAgICBvdXRMZW5ndGgrKztcbiAgICAgICAgaWYgKGtrID09PSBvZmZzZXRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgICBvdXRMZW5ndGggPT09IG9mZnNldHMubGVuZ3RoLFxuICAgICAgICAgICAgJ2JhZCBvZmZzZXRzIGlucHV0LCBzaG91bGQgYmUgaW4gaW5jcmVhc2luZyBvcmRlcjogJXMnLFxuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkob2Zmc2V0cyksXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gb3V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ29tcHV0ZXMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgYG5leHRgIHJhbmdlIHRoYXQgYXJlIG5ldyBjb21wYXJlZCB0byB0aGUgYHByZXZgIHJhbmdlLlxuICogSGFuZHkgZm9yIGNhbGN1bGF0aW5nIGhvdyBtYW55IG5ldyBpdGVtcyB3aWxsIGJlIHJlbmRlcmVkIHdoZW4gdGhlIHJlbmRlciB3aW5kb3cgY2hhbmdlcyBzbyB3ZVxuICogY2FuIHJlc3RyaWN0IHRoZSBudW1iZXIgb2YgbmV3IGl0ZW1zIHJlbmRlciBhdCBvbmNlIHNvIHRoYXQgY29udGVudCBjYW4gYXBwZWFyIG9uIHRoZSBzY3JlZW5cbiAqIGZhc3Rlci5cbiAqL1xuZnVuY3Rpb24gbmV3UmFuZ2VDb3VudChcbiAgcHJldjoge2ZpcnN0OiBudW1iZXIsIGxhc3Q6IG51bWJlcn0sXG4gIG5leHQ6IHtmaXJzdDogbnVtYmVyLCBsYXN0OiBudW1iZXJ9LFxuKTogbnVtYmVyIHtcbiAgcmV0dXJuIChcbiAgICBuZXh0Lmxhc3QgLVxuICAgIG5leHQuZmlyc3QgK1xuICAgIDEgLVxuICAgIE1hdGgubWF4KFxuICAgICAgMCxcbiAgICAgIDEgKyBNYXRoLm1pbihuZXh0Lmxhc3QsIHByZXYubGFzdCkgLSBNYXRoLm1heChuZXh0LmZpcnN0LCBwcmV2LmZpcnN0KSxcbiAgICApXG4gICk7XG59XG5cbi8qKlxuICogQ3VzdG9tIGxvZ2ljIGZvciBkZXRlcm1pbmluZyB3aGljaCBpdGVtcyBzaG91bGQgYmUgcmVuZGVyZWQgZ2l2ZW4gdGhlIGN1cnJlbnQgZnJhbWUgYW5kIHNjcm9sbFxuICogbWV0cmljcywgYXMgd2VsbCBhcyB0aGUgcHJldmlvdXMgcmVuZGVyIHN0YXRlLiBUaGUgYWxnb3JpdGhtIG1heSBldm9sdmUgb3ZlciB0aW1lLCBidXQgZ2VuZXJhbGx5XG4gKiBwcmlvcml0aXplcyB0aGUgdmlzaWJsZSBhcmVhIGZpcnN0LCB0aGVuIGV4cGFuZHMgdGhhdCB3aXRoIG92ZXJzY2FuIHJlZ2lvbnMgYWhlYWQgYW5kIGJlaGluZCxcbiAqIGJpYXNlZCBpbiB0aGUgZGlyZWN0aW9uIG9mIHNjcm9sbC5cbiAqL1xuZnVuY3Rpb24gY29tcHV0ZVdpbmRvd2VkUmVuZGVyTGltaXRzKFxuICBwcm9wczoge1xuICAgIGRhdGE6IGFueSxcbiAgICBnZXRJdGVtQ291bnQ6IChkYXRhOiBhbnkpID0+IG51bWJlcixcbiAgICBtYXhUb1JlbmRlclBlckJhdGNoOiBudW1iZXIsXG4gICAgd2luZG93U2l6ZTogbnVtYmVyLFxuICB9LFxuICBwcmV2OiB7Zmlyc3Q6IG51bWJlciwgbGFzdDogbnVtYmVyfSxcbiAgZ2V0RnJhbWVNZXRyaWNzQXBwcm94OiAoaW5kZXg6IG51bWJlcikgPT4ge2xlbmd0aDogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcn0sXG4gIHNjcm9sbE1ldHJpY3M6IHtcbiAgICBkdDogbnVtYmVyLFxuICAgIG9mZnNldDogbnVtYmVyLFxuICAgIHZlbG9jaXR5OiBudW1iZXIsXG4gICAgdmlzaWJsZUxlbmd0aDogbnVtYmVyLFxuICB9LFxuKToge2ZpcnN0OiBudW1iZXIsIGxhc3Q6IG51bWJlcn0ge1xuICBjb25zdCB7ZGF0YSwgZ2V0SXRlbUNvdW50LCBtYXhUb1JlbmRlclBlckJhdGNoLCB3aW5kb3dTaXplfSA9IHByb3BzO1xuICBjb25zdCBpdGVtQ291bnQgPSBnZXRJdGVtQ291bnQoZGF0YSk7XG4gIGlmIChpdGVtQ291bnQgPT09IDApIHtcbiAgICByZXR1cm4gcHJldjtcbiAgfVxuICBjb25zdCB7b2Zmc2V0LCB2ZWxvY2l0eSwgdmlzaWJsZUxlbmd0aH0gPSBzY3JvbGxNZXRyaWNzO1xuXG4gIC8vIFN0YXJ0IHdpdGggdmlzaWJsZSBhcmVhLCB0aGVuIGNvbXB1dGUgbWF4aW11bSBvdmVyc2NhbiByZWdpb24gYnkgZXhwYW5kaW5nIGZyb20gdGhlcmUsIGJpYXNlZFxuICAvLyBpbiB0aGUgZGlyZWN0aW9uIG9mIHNjcm9sbC4gVG90YWwgb3ZlcnNjYW4gYXJlYSBpcyBjYXBwZWQsIHdoaWNoIHNob3VsZCBjYXAgbWVtb3J5IGNvbnN1bXB0aW9uXG4gIC8vIHRvby5cbiAgY29uc3QgdmlzaWJsZUJlZ2luID0gTWF0aC5tYXgoMCwgb2Zmc2V0KTtcbiAgY29uc3QgdmlzaWJsZUVuZCA9IHZpc2libGVCZWdpbiArIHZpc2libGVMZW5ndGg7XG4gIGNvbnN0IG92ZXJzY2FuTGVuZ3RoID0gKHdpbmRvd1NpemUgLSAxKSAqIHZpc2libGVMZW5ndGg7XG5cbiAgLy8gQ29uc2lkZXJpbmcgdmVsb2NpdHkgc2VlbXMgdG8gaW50cm9kdWNlIG1vcmUgY2h1cm4gdGhhbiBpdCdzIHdvcnRoLlxuICBjb25zdCBsZWFkRmFjdG9yID0gMC41OyAvLyBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB2ZWxvY2l0eSAvIDI1ICsgMC41KSk7XG5cbiAgY29uc3QgZmlsbFByZWZlcmVuY2UgPVxuICAgIHZlbG9jaXR5ID4gMSA/ICdhZnRlcicgOiB2ZWxvY2l0eSA8IC0xID8gJ2JlZm9yZScgOiAnbm9uZSc7XG5cbiAgY29uc3Qgb3ZlcnNjYW5CZWdpbiA9IE1hdGgubWF4KFxuICAgIDAsXG4gICAgdmlzaWJsZUJlZ2luIC0gKDEgLSBsZWFkRmFjdG9yKSAqIG92ZXJzY2FuTGVuZ3RoLFxuICApO1xuICBjb25zdCBvdmVyc2NhbkVuZCA9IE1hdGgubWF4KDAsIHZpc2libGVFbmQgKyBsZWFkRmFjdG9yICogb3ZlcnNjYW5MZW5ndGgpO1xuXG4gIGNvbnN0IGxhc3RJdGVtT2Zmc2V0ID0gZ2V0RnJhbWVNZXRyaWNzQXBwcm94KGl0ZW1Db3VudCAtIDEpLm9mZnNldDtcbiAgaWYgKGxhc3RJdGVtT2Zmc2V0IDwgb3ZlcnNjYW5CZWdpbikge1xuICAgIC8vIEVudGlyZSBsaXN0IGlzIGJlZm9yZSBvdXIgb3ZlcnNjYW4gd2luZG93XG4gICAgcmV0dXJuIHtcbiAgICAgIGZpcnN0OiBNYXRoLm1heCgwLCBpdGVtQ291bnQgLSAxIC0gbWF4VG9SZW5kZXJQZXJCYXRjaCksXG4gICAgICBsYXN0OiBpdGVtQ291bnQgLSAxLFxuICAgIH07XG4gIH1cblxuICAvLyBGaW5kIHRoZSBpbmRpY2VzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgaXRlbXMgYXQgdGhlIHJlbmRlciBib3VuZGFyaWVzIHdlJ3JlIHRhcmdldGluZy5cbiAgbGV0IFtvdmVyc2NhbkZpcnN0LCBmaXJzdCwgbGFzdCwgb3ZlcnNjYW5MYXN0XSA9IGVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzKFxuICAgIFtvdmVyc2NhbkJlZ2luLCB2aXNpYmxlQmVnaW4sIHZpc2libGVFbmQsIG92ZXJzY2FuRW5kXSxcbiAgICBwcm9wcy5nZXRJdGVtQ291bnQocHJvcHMuZGF0YSksXG4gICAgZ2V0RnJhbWVNZXRyaWNzQXBwcm94LFxuICApO1xuICBvdmVyc2NhbkZpcnN0ID0gb3ZlcnNjYW5GaXJzdCA9PSBudWxsID8gMCA6IG92ZXJzY2FuRmlyc3Q7XG4gIGZpcnN0ID0gZmlyc3QgPT0gbnVsbCA/IE1hdGgubWF4KDAsIG92ZXJzY2FuRmlyc3QpIDogZmlyc3Q7XG4gIG92ZXJzY2FuTGFzdCA9IG92ZXJzY2FuTGFzdCA9PSBudWxsID8gaXRlbUNvdW50IC0gMSA6IG92ZXJzY2FuTGFzdDtcbiAgbGFzdCA9XG4gICAgbGFzdCA9PSBudWxsXG4gICAgICA/IE1hdGgubWluKG92ZXJzY2FuTGFzdCwgZmlyc3QgKyBtYXhUb1JlbmRlclBlckJhdGNoIC0gMSlcbiAgICAgIDogbGFzdDtcbiAgY29uc3QgdmlzaWJsZSA9IHtmaXJzdCwgbGFzdH07XG5cbiAgLy8gV2Ugd2FudCB0byBsaW1pdCB0aGUgbnVtYmVyIG9mIG5ldyBjZWxscyB3ZSdyZSByZW5kZXJpbmcgcGVyIGJhdGNoIHNvIHRoYXQgd2UgY2FuIGZpbGwgdGhlXG4gIC8vIGNvbnRlbnQgb24gdGhlIHNjcmVlbiBxdWlja2x5LiBJZiB3ZSByZW5kZXJlZCB0aGUgZW50aXJlIG92ZXJzY2FuIHdpbmRvdyBhdCBvbmNlLCB0aGUgdXNlclxuICAvLyBjb3VsZCBiZSBzdGFyaW5nIGF0IHdoaXRlIHNwYWNlIGZvciBhIGxvbmcgdGltZSB3YWl0aW5nIGZvciBhIGJ1bmNoIG9mIG9mZnNjcmVlbiBjb250ZW50IHRvXG4gIC8vIHJlbmRlci5cbiAgbGV0IG5ld0NlbGxDb3VudCA9IG5ld1JhbmdlQ291bnQocHJldiwgdmlzaWJsZSk7XG5cbiAgd2hpbGUgKHRydWUpIHtcbiAgICBpZiAoZmlyc3QgPD0gb3ZlcnNjYW5GaXJzdCAmJiBsYXN0ID49IG92ZXJzY2FuTGFzdCkge1xuICAgICAgLy8gSWYgd2UgZmlsbCB0aGUgZW50aXJlIG92ZXJzY2FuIHJhbmdlLCB3ZSdyZSBkb25lLlxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IG1heE5ld0NlbGxzID0gbmV3Q2VsbENvdW50ID49IG1heFRvUmVuZGVyUGVyQmF0Y2g7XG4gICAgY29uc3QgZmlyc3RXaWxsQWRkTW9yZSA9IGZpcnN0IDw9IHByZXYuZmlyc3QgfHwgZmlyc3QgPiBwcmV2Lmxhc3Q7XG4gICAgY29uc3QgZmlyc3RTaG91bGRJbmNyZW1lbnQgPVxuICAgICAgZmlyc3QgPiBvdmVyc2NhbkZpcnN0ICYmICghbWF4TmV3Q2VsbHMgfHwgIWZpcnN0V2lsbEFkZE1vcmUpO1xuICAgIGNvbnN0IGxhc3RXaWxsQWRkTW9yZSA9IGxhc3QgPj0gcHJldi5sYXN0IHx8IGxhc3QgPCBwcmV2LmZpcnN0O1xuICAgIGNvbnN0IGxhc3RTaG91bGRJbmNyZW1lbnQgPVxuICAgICAgbGFzdCA8IG92ZXJzY2FuTGFzdCAmJiAoIW1heE5ld0NlbGxzIHx8ICFsYXN0V2lsbEFkZE1vcmUpO1xuICAgIGlmIChtYXhOZXdDZWxscyAmJiAhZmlyc3RTaG91bGRJbmNyZW1lbnQgJiYgIWxhc3RTaG91bGRJbmNyZW1lbnQpIHtcbiAgICAgIC8vIFdlIG9ubHkgd2FudCB0byBzdG9wIGlmIHdlJ3ZlIGhpdCBtYXhOZXdDZWxscyBBTkQgd2UgY2Fubm90IGluY3JlbWVudCBmaXJzdCBvciBsYXN0XG4gICAgICAvLyB3aXRob3V0IHJlbmRlcmluZyBuZXcgaXRlbXMuIFRoaXMgbGV0J3MgdXMgcHJlc2VydmUgYXMgbWFueSBhbHJlYWR5IHJlbmRlcmVkIGl0ZW1zIGFzXG4gICAgICAvLyBwb3NzaWJsZSwgcmVkdWNpbmcgcmVuZGVyIGNodXJuIGFuZCBrZWVwaW5nIHRoZSByZW5kZXJlZCBvdmVyc2NhbiByYW5nZSBhcyBsYXJnZSBhc1xuICAgICAgLy8gcG9zc2libGUuXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKFxuICAgICAgZmlyc3RTaG91bGRJbmNyZW1lbnQgJiZcbiAgICAgICEoZmlsbFByZWZlcmVuY2UgPT09ICdhZnRlcicgJiYgbGFzdFNob3VsZEluY3JlbWVudCAmJiBsYXN0V2lsbEFkZE1vcmUpXG4gICAgKSB7XG4gICAgICBpZiAoZmlyc3RXaWxsQWRkTW9yZSkge1xuICAgICAgICBuZXdDZWxsQ291bnQrKztcbiAgICAgIH1cbiAgICAgIGZpcnN0LS07XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGxhc3RTaG91bGRJbmNyZW1lbnQgJiZcbiAgICAgICEoZmlsbFByZWZlcmVuY2UgPT09ICdiZWZvcmUnICYmIGZpcnN0U2hvdWxkSW5jcmVtZW50ICYmIGZpcnN0V2lsbEFkZE1vcmUpXG4gICAgKSB7XG4gICAgICBpZiAobGFzdFdpbGxBZGRNb3JlKSB7XG4gICAgICAgIG5ld0NlbGxDb3VudCsrO1xuICAgICAgfVxuICAgICAgbGFzdCsrO1xuICAgIH1cbiAgfVxuICBpZiAoXG4gICAgIShcbiAgICAgIGxhc3QgPj0gZmlyc3QgJiZcbiAgICAgIGZpcnN0ID49IDAgJiZcbiAgICAgIGxhc3QgPCBpdGVtQ291bnQgJiZcbiAgICAgIGZpcnN0ID49IG92ZXJzY2FuRmlyc3QgJiZcbiAgICAgIGxhc3QgPD0gb3ZlcnNjYW5MYXN0ICYmXG4gICAgICBmaXJzdCA8PSB2aXNpYmxlLmZpcnN0ICYmXG4gICAgICBsYXN0ID49IHZpc2libGUubGFzdFxuICAgIClcbiAgKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0JhZCB3aW5kb3cgY2FsY3VsYXRpb24gJyArXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBmaXJzdCxcbiAgICAgICAgICBsYXN0LFxuICAgICAgICAgIGl0ZW1Db3VudCxcbiAgICAgICAgICBvdmVyc2NhbkZpcnN0LFxuICAgICAgICAgIG92ZXJzY2FuTGFzdCxcbiAgICAgICAgICB2aXNpYmxlLFxuICAgICAgICB9KSxcbiAgICApO1xuICB9XG4gIHJldHVybiB7Zmlyc3QsIGxhc3R9O1xufVxuXG5jb25zdCBWaXJ0dWFsaXplVXRpbHMgPSB7XG4gIGNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyxcbiAgZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMsXG4gIG5ld1JhbmdlQ291bnQsXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFZpcnR1YWxpemVVdGlscztcbiJdLCJtYXBwaW5ncyI6IkFBU0EsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsZUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBRWIsSUFBTUUsU0FBUyxHQUFH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