{"version":3,"names":["_interopRequireDefault","require","_extends2","EventEmitter","EventEmitterWithHolding","EventHolder","invariant","keyOf","TYPES_KEY","__types","mixInEventEmitter","cls","types","target","prototype","__eventEmitter","ctor","constructor","Object","Function","hasOwnProperty","default","EventEmitterMixin","emit","eventType","a","b","c","d","e","_","__getEventEmitter","emitAndHold","addListener","listener","context","once","addRetroactiveListener","addListenerMap","listenerMap","addRetroactiveListenerMap","removeAllListeners","removeCurrentListener","releaseHeldEventType","emitter","__DEV__","EventValidator","addValidation","holder","module","exports"],"sources":["mixInEventEmitter.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\n'use strict';\n\nconst EventEmitter = require('./EventEmitter');\nconst EventEmitterWithHolding = require('./EventEmitterWithHolding');\nconst EventHolder = require('./EventHolder');\n\nconst invariant = require('invariant');\nconst keyOf = require('fbjs/lib/keyOf');\n\nimport type EmitterSubscription from './EmitterSubscription';\n\nconst TYPES_KEY = keyOf({__types: true});\n\n/**\n * API to setup an object or constructor to be able to emit data events.\n *\n * @example\n * function Dog() { ...dog stuff... }\n * mixInEventEmitter(Dog, {bark: true});\n *\n * var puppy = new Dog();\n * puppy.addListener('bark', function (volume) {\n *   console.log('Puppy', this, 'barked at volume:', volume);\n * });\n * puppy.emit('bark', 'quiet');\n * // Puppy <puppy> barked at volume: quiet\n *\n *\n * // A \"singleton\" object may also be commissioned:\n *\n * var Singleton = {};\n * mixInEventEmitter(Singleton, {lonely: true});\n * Singleton.emit('lonely', true);\n */\nfunction mixInEventEmitter(cls: Function | Object, types: Object) {\n  invariant(types, 'Must supply set of valid event types');\n\n  // If this is a constructor, write to the prototype, otherwise write to the\n  // singleton object.\n  const target = cls.prototype || cls;\n\n  invariant(!target.__eventEmitter, 'An active emitter is already mixed in');\n\n  const ctor = cls.constructor;\n  if (ctor) {\n    invariant(\n      ctor === Object || ctor === Function,\n      'Mix EventEmitter into a class, not an instance',\n    );\n  }\n\n  // Keep track of the provided types, union the types if they already exist,\n  // which allows for prototype subclasses to provide more types.\n  if (target.hasOwnProperty(TYPES_KEY)) {\n    Object.assign(target.__types, types);\n  } else if (target.__types) {\n    target.__types = Object.assign({}, target.__types, types);\n  } else {\n    target.__types = types;\n  }\n  Object.assign(target, EventEmitterMixin);\n}\n\nconst EventEmitterMixin = {\n  emit: function(eventType, a, b, c, d, e, _) {\n    return this.__getEventEmitter().emit(eventType, a, b, c, d, e, _);\n  },\n\n  emitAndHold: function(eventType, a, b, c, d, e, _) {\n    return this.__getEventEmitter().emitAndHold(eventType, a, b, c, d, e, _);\n  },\n\n  addListener: function(eventType, listener, context): EmitterSubscription {\n    return this.__getEventEmitter().addListener(eventType, listener, context);\n  },\n\n  once: function(eventType, listener, context) {\n    return this.__getEventEmitter().once(eventType, listener, context);\n  },\n\n  addRetroactiveListener: function(eventType, listener, context) {\n    return this.__getEventEmitter().addRetroactiveListener(\n      eventType,\n      listener,\n      context,\n    );\n  },\n\n  addListenerMap: function(listenerMap, context) {\n    return this.__getEventEmitter().addListenerMap(listenerMap, context);\n  },\n\n  addRetroactiveListenerMap: function(listenerMap, context) {\n    return this.__getEventEmitter().addListenerMap(listenerMap, context);\n  },\n\n  removeAllListeners: function() {\n    this.__getEventEmitter().removeAllListeners();\n  },\n\n  removeCurrentListener: function() {\n    this.__getEventEmitter().removeCurrentListener();\n  },\n\n  releaseHeldEventType: function(eventType) {\n    this.__getEventEmitter().releaseHeldEventType(eventType);\n  },\n\n  __getEventEmitter: function() {\n    if (!this.__eventEmitter) {\n      let emitter = new EventEmitter();\n      if (__DEV__) {\n        const EventValidator = require('./EventValidator');\n        emitter = EventValidator.addValidation(emitter, this.__types);\n      }\n\n      const holder = new EventHolder();\n      this.__eventEmitter = new EventEmitterWithHolding(emitter, holder);\n    }\n    return this.__eventEmitter;\n  },\n};\n\nmodule.exports = mixInEventEmitter;\n"],"mappings":"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"}