{"version":3,"names":["_interopRequireDefault","require","_classCallCheck2","_createClass2","EventEmitterWithHolding","emitter","holder","default","_emitter","_eventHolder","_currentEventToken","_emittingHeldEvents","key","value","addListener","eventType","listener","context","once","addRetroactiveListener","subscription","emitToListener","removeAllListeners","removeCurrentListener","listeners","emit","_this$_emitter","_len","arguments","length","args","Array","_key","apply","concat","emitAndHold","_this$_eventHolder","_this$_emitter2","_len2","_key2","holdEvent","releaseCurrentEvent","releaseEvent","releaseHeldEventType","releaseEventType","module","exports"],"sources":["EventEmitterWithHolding.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\n'use strict';\n\nimport type EmitterSubscription from './EmitterSubscription';\nimport type EventEmitter from './EventEmitter';\nimport type EventHolder from './EventHolder';\n\n/**\n * @class EventEmitterWithHolding\n * @description\n * An EventEmitterWithHolding decorates an event emitter and enables one to\n * \"hold\" or cache events and then have a handler register later to actually\n * handle them.\n *\n * This is separated into its own decorator so that only those who want to use\n * the holding functionality have to and others can just use an emitter. Since\n * it implements the emitter interface it can also be combined with anything\n * that uses an emitter.\n */\nclass EventEmitterWithHolding {\n  _emitter: EventEmitter;\n  _eventHolder: EventHolder;\n  _currentEventToken: ?Object;\n  _emittingHeldEvents: boolean;\n\n  /**\n   * @constructor\n   * @param {object} emitter - The object responsible for emitting the actual\n   *   events.\n   * @param {object} holder - The event holder that is responsible for holding\n   *   and then emitting held events.\n   */\n  constructor(emitter: EventEmitter, holder: EventHolder) {\n    this._emitter = emitter;\n    this._eventHolder = holder;\n    this._currentEventToken = null;\n    this._emittingHeldEvents = false;\n  }\n\n  /**\n   * @see EventEmitter#addListener\n   */\n  addListener(eventType: string, listener: Function, context: ?Object): any {\n    return this._emitter.addListener(eventType, listener, context);\n  }\n\n  /**\n   * @see EventEmitter#once\n   */\n  once(eventType: string, listener: Function, context: ?Object): any {\n    return this._emitter.once(eventType, listener, context);\n  }\n\n  /**\n   * Adds a listener to be invoked when events of the specified type are\n   * emitted. An optional calling context may be provided. The data arguments\n   * emitted will be passed to the listener function. In addition to subscribing\n   * to all subsequent events, this method will also handle any events that have\n   * already been emitted, held, and not released.\n   *\n   * @param {string} eventType - Name of the event to listen to\n   * @param {function} listener - Function to invoke when the specified event is\n   *   emitted\n   * @param {*} context - Optional context object to use when invoking the\n   *   listener\n   *\n   * @example\n   *   emitter.emitAndHold('someEvent', 'abc');\n   *\n   *   emitter.addRetroactiveListener('someEvent', function(message) {\n   *     console.log(message);\n   *   }); // logs 'abc'\n   */\n  addRetroactiveListener(\n    eventType: string,\n    listener: Function,\n    context: ?Object,\n  ): EmitterSubscription {\n    const subscription = this._emitter.addListener(\n      eventType,\n      listener,\n      context,\n    );\n\n    this._emittingHeldEvents = true;\n    this._eventHolder.emitToListener(eventType, listener, context);\n    this._emittingHeldEvents = false;\n\n    return subscription;\n  }\n\n  /**\n   * @see EventEmitter#removeAllListeners\n   */\n  removeAllListeners(eventType: string) {\n    this._emitter.removeAllListeners(eventType);\n  }\n\n  /**\n   * @see EventEmitter#removeCurrentListener\n   */\n  removeCurrentListener() {\n    this._emitter.removeCurrentListener();\n  }\n\n  /**\n   * @see EventEmitter#listeners\n   */\n  listeners(eventType: string): any /* TODO: Annotate return type here */ {\n    return this._emitter.listeners(eventType);\n  }\n\n  /**\n   * @see EventEmitter#emit\n   */\n  emit(eventType: string, ...args: any) {\n    this._emitter.emit(eventType, ...args);\n  }\n\n  /**\n   * Emits an event of the given type with the given data, and holds that event\n   * in order to be able to dispatch it to a later subscriber when they say they\n   * want to handle held events.\n   *\n   * @param {string} eventType - Name of the event to emit\n   * @param {...*} Arbitrary arguments to be passed to each registered listener\n   *\n   * @example\n   *   emitter.emitAndHold('someEvent', 'abc');\n   *\n   *   emitter.addRetroactiveListener('someEvent', function(message) {\n   *     console.log(message);\n   *   }); // logs 'abc'\n   */\n  emitAndHold(eventType: string, ...args: any) {\n    this._currentEventToken = this._eventHolder.holdEvent(eventType, ...args);\n    this._emitter.emit(eventType, ...args);\n    this._currentEventToken = null;\n  }\n\n  /**\n   * @see EventHolder#releaseCurrentEvent\n   */\n  releaseCurrentEvent() {\n    if (this._currentEventToken) {\n      this._eventHolder.releaseEvent(this._currentEventToken);\n    } else if (this._emittingHeldEvents) {\n      this._eventHolder.releaseCurrentEvent();\n    }\n  }\n\n  /**\n   * @see EventHolder#releaseEventType\n   * @param {string} eventType\n   */\n  releaseHeldEventType(eventType: string) {\n    this._eventHolder.releaseEventType(eventType);\n  }\n}\n\nmodule.exports = EventEmitterWithHolding;\n"],"mappings":"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"}