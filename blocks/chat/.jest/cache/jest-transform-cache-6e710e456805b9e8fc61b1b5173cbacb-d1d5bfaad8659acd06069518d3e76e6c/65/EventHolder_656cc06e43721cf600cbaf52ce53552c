37e8df2314aac7794d777559dc1e60a9
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var invariant = require('invariant');
var EventHolder = function () {
  function EventHolder() {
    (0, _classCallCheck2.default)(this, EventHolder);
    this._heldEvents = {};
    this._currentEventKey = null;
  }
  (0, _createClass2.default)(EventHolder, [{
    key: "holdEvent",
    value: function holdEvent(eventType) {
      this._heldEvents[eventType] = this._heldEvents[eventType] || [];
      var eventsOfType = this._heldEvents[eventType];
      var key = {
        eventType: eventType,
        index: eventsOfType.length
      };
      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }
      eventsOfType.push(args);
      return key;
    }
  }, {
    key: "emitToListener",
    value: function emitToListener(eventType, listener, context) {
      var _this = this;
      var eventsOfType = this._heldEvents[eventType];
      if (!eventsOfType) {
        return;
      }
      var origEventKey = this._currentEventKey;
      eventsOfType.forEach(function (eventHeld, index) {
        if (!eventHeld) {
          return;
        }
        _this._currentEventKey = {
          eventType: eventType,
          index: index
        };
        listener.apply(context, eventHeld);
      });
      this._currentEventKey = origEventKey;
    }
  }, {
    key: "releaseCurrentEvent",
    value: function releaseCurrentEvent() {
      invariant(this._currentEventKey !== null, 'Not in an emitting cycle; there is no current event');
      this._currentEventKey && this.releaseEvent(this._currentEventKey);
    }
  }, {
    key: "releaseEvent",
    value: function releaseEvent(token) {
      delete this._heldEvents[token.eventType][token.index];
    }
  }, {
    key: "releaseEventType",
    value: function releaseEventType(type) {
      this._heldEvents[type] = [];
    }
  }]);
  return EventHolder;
}();
module.exports = EventHolder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiaW52YXJpYW50IiwiRXZlbnRIb2xkZXIiLCJkZWZhdWx0IiwiX2hlbGRFdmVudHMiLCJfY3VycmVudEV2ZW50S2V5Iiwia2V5IiwidmFsdWUiLCJob2xkRXZlbnQiLCJldmVudFR5cGUiLCJldmVudHNPZlR5cGUiLCJpbmRleCIsImxlbmd0aCIsIl9sZW4iLCJhcmd1bWVudHMiLCJhcmdzIiwiQXJyYXkiLCJfa2V5IiwicHVzaCIsImVtaXRUb0xpc3RlbmVyIiwibGlzdGVuZXIiLCJjb250ZXh0IiwiX3RoaXMiLCJvcmlnRXZlbnRLZXkiLCJmb3JFYWNoIiwiZXZlbnRIZWxkIiwiYXBwbHkiLCJyZWxlYXNlQ3VycmVudEV2ZW50IiwicmVsZWFzZUV2ZW50IiwidG9rZW4iLCJyZWxlYXNlRXZlbnRUeXBlIiwidHlwZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJFdmVudEhvbGRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcblxuY2xhc3MgRXZlbnRIb2xkZXIge1xuICBfaGVsZEV2ZW50czogT2JqZWN0O1xuICBfY3VycmVudEV2ZW50S2V5OiA/T2JqZWN0O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX2hlbGRFdmVudHMgPSB7fTtcbiAgICB0aGlzLl9jdXJyZW50RXZlbnRLZXkgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEhvbGRzIGEgZ2l2ZW4gZXZlbnQgZm9yIHByb2Nlc3NpbmcgbGF0ZXIuXG4gICAqXG4gICAqIFRPRE86IEFubm90YXRlIHJldHVybiB0eXBlIGJldHRlci4gVGhlIHN0cnVjdHVyYWwgdHlwZSBvZiB0aGUgcmV0dXJuIGhlcmVcbiAgICogICAgICAgaXMgcHJldHR5IG9idmlvdXMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBob2xkIGFuZCBsYXRlciBlbWl0XG4gICAqIEBwYXJhbSB7Li4uKn0gQXJiaXRyYXJ5IGFyZ3VtZW50cyB0byBiZSBwYXNzZWQgdG8gZWFjaCByZWdpc3RlcmVkIGxpc3RlbmVyXG4gICAqIEByZXR1cm4ge29iamVjdH0gVG9rZW4gdGhhdCBjYW4gYmUgdXNlZCB0byByZWxlYXNlIHRoZSBoZWxkIGV2ZW50XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqICAgaG9sZGVyLmhvbGRFdmVudCh7c29tZUV2ZW50OiAnYWJjJ30pO1xuICAgKlxuICAgKiAgIGhvbGRlci5lbWl0VG9IYW5kbGVyKHtcbiAgICogICAgIHNvbWVFdmVudDogZnVuY3Rpb24oZGF0YSwgZXZlbnQpIHtcbiAgICogICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAqICAgICB9XG4gICAqICAgfSk7IC8vbG9ncyAnYWJjJ1xuICAgKlxuICAgKi9cbiAgaG9sZEV2ZW50KFxuICAgIGV2ZW50VHlwZTogc3RyaW5nLFxuICAgIC4uLmFyZ3M6IGFueVxuICApOiAkVEVNUE9SQVJZJG9iamVjdDx7fGV2ZW50VHlwZTogc3RyaW5nLCBpbmRleDogJEZsb3dGaXhNZUVtcHR5fH0+IHtcbiAgICB0aGlzLl9oZWxkRXZlbnRzW2V2ZW50VHlwZV0gPSB0aGlzLl9oZWxkRXZlbnRzW2V2ZW50VHlwZV0gfHwgW107XG4gICAgY29uc3QgZXZlbnRzT2ZUeXBlID0gdGhpcy5faGVsZEV2ZW50c1tldmVudFR5cGVdO1xuICAgIGNvbnN0IGtleSA9IHtcbiAgICAgIGV2ZW50VHlwZTogZXZlbnRUeXBlLFxuICAgICAgaW5kZXg6IGV2ZW50c09mVHlwZS5sZW5ndGgsXG4gICAgfTtcbiAgICBldmVudHNPZlR5cGUucHVzaChhcmdzKTtcbiAgICByZXR1cm4ga2V5O1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIHRoZSBoZWxkIGV2ZW50cyBvZiB0aGUgc3BlY2lmaWVkIHR5cGUgdG8gdGhlIGdpdmVuIGxpc3RlbmVyLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IGV2ZW50VHlwZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGV2ZW50cyB0byByZXBsYXlcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBUaGUgbGlzdGVuZXIgdG8gd2hpY2ggdG8gZGlzcGF0Y2ggdGhlIGV2ZW50XG4gICAqIEBwYXJhbSB7P29iamVjdH0gY29udGV4dCAtIE9wdGlvbmFsIGNvbnRleHQgb2JqZWN0IHRvIHVzZSB3aGVuIGludm9raW5nXG4gICAqICAgdGhlIGxpc3RlbmVyXG4gICAqL1xuICBlbWl0VG9MaXN0ZW5lcihldmVudFR5cGU6ID9zdHJpbmcsIGxpc3RlbmVyOiBGdW5jdGlvbiwgY29udGV4dDogP09iamVjdCkge1xuICAgIGNvbnN0IGV2ZW50c09mVHlwZSA9IHRoaXMuX2hlbGRFdmVudHNbZXZlbnRUeXBlXTtcbiAgICBpZiAoIWV2ZW50c09mVHlwZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBvcmlnRXZlbnRLZXkgPSB0aGlzLl9jdXJyZW50RXZlbnRLZXk7XG4gICAgZXZlbnRzT2ZUeXBlLmZvckVhY2goKC8qP2FycmF5Ki8gZXZlbnRIZWxkLCAvKm51bWJlciovIGluZGV4KSA9PiB7XG4gICAgICBpZiAoIWV2ZW50SGVsZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLl9jdXJyZW50RXZlbnRLZXkgPSB7XG4gICAgICAgIGV2ZW50VHlwZTogZXZlbnRUeXBlLFxuICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICB9O1xuICAgICAgbGlzdGVuZXIuYXBwbHkoY29udGV4dCwgZXZlbnRIZWxkKTtcbiAgICB9KTtcbiAgICB0aGlzLl9jdXJyZW50RXZlbnRLZXkgPSBvcmlnRXZlbnRLZXk7XG4gIH1cblxuICAvKipcbiAgICogUHJvdmlkZXMgYW4gQVBJIHRoYXQgY2FuIGJlIGNhbGxlZCBkdXJpbmcgYW4gZXZlbnRpbmcgY3ljbGUgdG8gcmVsZWFzZVxuICAgKiB0aGUgbGFzdCBldmVudCB0aGF0IHdhcyBpbnZva2VkLCBzbyB0aGF0IGl0IGlzIG5vIGxvbmdlciBcImhlbGRcIi5cbiAgICpcbiAgICogSWYgaXQgaXMgY2FsbGVkIHdoZW4gbm90IGluc2lkZSBvZiBhbiBlbWl0dGluZyBjeWNsZSBpdCB3aWxsIHRocm93LlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gV2hlbiBjYWxsZWQgbm90IGR1cmluZyBhbiBldmVudGluZyBjeWNsZVxuICAgKi9cbiAgcmVsZWFzZUN1cnJlbnRFdmVudCgpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0aGlzLl9jdXJyZW50RXZlbnRLZXkgIT09IG51bGwsXG4gICAgICAnTm90IGluIGFuIGVtaXR0aW5nIGN5Y2xlOyB0aGVyZSBpcyBubyBjdXJyZW50IGV2ZW50JyxcbiAgICApO1xuICAgIHRoaXMuX2N1cnJlbnRFdmVudEtleSAmJiB0aGlzLnJlbGVhc2VFdmVudCh0aGlzLl9jdXJyZW50RXZlbnRLZXkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbGVhc2VzIHRoZSBldmVudCBjb3JyZXNwb25kaW5nIHRvIHRoZSBoYW5kbGUgdGhhdCB3YXMgcmV0dXJuZWQgd2hlbiB0aGVcbiAgICogZXZlbnQgd2FzIGZpcnN0IGhlbGQuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB0b2tlbiAtIFRoZSB0b2tlbiByZXR1cm5lZCBmcm9tIGhvbGRFdmVudFxuICAgKi9cbiAgcmVsZWFzZUV2ZW50KHRva2VuOiBPYmplY3QpIHtcbiAgICBkZWxldGUgdGhpcy5faGVsZEV2ZW50c1t0b2tlbi5ldmVudFR5cGVdW3Rva2VuLmluZGV4XTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWxlYXNlcyBhbGwgZXZlbnRzIG9mIGEgY2VydGFpbiB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgKi9cbiAgcmVsZWFzZUV2ZW50VHlwZSh0eXBlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9oZWxkRXZlbnRzW3R5cGVdID0gW107XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEhvbGRlcjtcbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsZ0JBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGFBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUViLElBQU1HLFNBQVMsR0FBR0gsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUFDLElBRWpDSSxXQUFXO0VBSWYsU0FBQUEsWUFBQSxFQUFjO0lBQUEsSUFBQUgsZ0JBQUEsQ0FBQUksT0FBQSxRQUFBRCxXQUFBO0lBQ1osSUFBSSxDQUFDRSxXQUFXLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLElBQUksQ0FBQ0MsZ0JBQWdCLEdBQUcsSUFBSTtFQUM5QjtFQUFDLElBQUFMLGFBQUEsQ0FBQUcsT0FBQSxFQUFBRCxXQUFBO0lBQUFJLEdBQUE7SUFBQUMsS0FBQSxFQXVCRCxTQUFBQyxVQUNFQyxTQUFpQixFQUVpRDtNQUNsRSxJQUFJLENBQUNMLFdBQVcsQ0FBQ0ssU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDTCxXQUFXLENBQUNLLFNBQVMsQ0FBQyxJQUFJLEVBQUU7TUFDL0QsSUFBTUMsWUFBWSxHQUFHLElBQUksQ0FBQ04sV0FBVyxDQUFDSyxTQUFTLENBQUM7TUFDaEQsSUFBTUgsR0FBRyxHQUFHO1FBQ1ZHLFNBQVMsRUFBRUEsU0FBUztRQUNwQkUsS0FBSyxFQUFFRCxZQUFZLENBQUNFO01BQ3RCLENBQUM7TUFBQyxTQUFBQyxJQUFBLEdBQUFDLFNBQUEsQ0FBQUYsTUFBQSxFQVBDRyxJQUFJLE9BQUFDLEtBQUEsQ0FBQUgsSUFBQSxPQUFBQSxJQUFBLFdBQUFJLElBQUEsTUFBQUEsSUFBQSxHQUFBSixJQUFBLEVBQUFJLElBQUE7UUFBSkYsSUFBSSxDQUFBRSxJQUFBLFFBQUFILFNBQUEsQ0FBQUcsSUFBQTtNQUFBO01BUVBQLFlBQVksQ0FBQ1EsSUFBSSxDQUFDSCxJQUFJLENBQUM7TUFDdkIsT0FBT1QsR0FBRztJQUNaO0VBQUM7SUFBQUEsR0FBQTtJQUFBQyxLQUFBLEVBVUQsU0FBQVksZUFBZVYsU0FBa0IsRUFBRVcsUUFBa0IsRUFBRUMsT0FBZ0IsRUFBRTtNQUFBLElBQUFDLEtBQUE7TUFDdkUsSUFBTVosWUFBWSxHQUFHLElBQUksQ0FBQ04sV0FBVyxDQUFDSyxTQUFTLENBQUM7TUFDaEQsSUFBSSxDQUFDQyxZQUFZLEVBQUU7UUFDakI7TUFDRjtNQUNBLElBQU1hLFlBQVksR0FBRyxJQUFJLENBQUNsQixnQkFBZ0I7TUFDMUNLLFlBQVksQ0FBQ2MsT0FBTyxDQUFDLFVBQVlDLFNBQVMsRUFBYWQsS0FBSyxFQUFLO1FBQy9ELElBQUksQ0FBQ2MsU0FBUyxFQUFFO1VBQ2Q7UUFDRjtRQUNBSCxLQUFJLENBQUNqQixnQkFBZ0IsR0FBRztVQUN0QkksU0FBUyxFQUFFQSxTQUFTO1VBQ3BCRSxLQUFLLEVBQUVBO1FBQ1QsQ0FBQztRQUNEUyxRQUFRLENBQUNNLEtBQUssQ0FBQ0wsT0FBTyxFQUFFSSxTQUFTLENBQUM7TUFDcEMsQ0FBQyxDQUFDO01BQ0YsSUFBSSxDQUFDcEIsZ0JBQWdCLEdBQUdrQixZQUFZO0lBQ3RDO0VBQUM7SUFBQWpCLEdBQUE7SUFBQUMsS0FBQSxFQVVELFNBQUFvQixvQkFBQSxFQUFzQjtNQUNwQjFCLFNBQVMsQ0FDUCxJQUFJLENBQUNJLGdCQUFnQixLQUFLLElBQUksRUFDOUIscURBQ0YsQ0FBQztNQUNELElBQUksQ0FBQ0EsZ0JBQWdCLElBQUksSUFBSSxDQUFDdUIsWUFBWSxDQUFDLElBQUksQ0FBQ3ZCLGdCQUFnQixDQUFDO0lBQ25FO0VBQUM7SUFBQUMsR0FBQTtJQUFBQyxLQUFBLEVBUUQsU0FBQXFCLGFBQWFDLEtBQWEsRUFBRTtNQUMxQixPQUFPLElBQUksQ0FBQ3pCLFdBQVcsQ0FBQ3lCLEtBQUssQ0FBQ3BCLFNBQVMsQ0FBQyxDQUFDb0IsS0FBSyxDQUFDbEIsS0FBSyxDQUFDO0lBQ3ZEO0VBQUM7SUFBQUwsR0FBQTtJQUFBQyxLQUFBLEVBT0QsU0FBQXVCLGlCQUFpQkMsSUFBWSxFQUFFO01BQzdCLElBQUksQ0FBQzNCLFdBQVcsQ0FBQzJCLElBQUksQ0FBQyxHQUFHLEVBQUU7SUFDN0I7RUFBQztFQUFBLE9BQUE3QixXQUFBO0FBQUE7QUFHSDhCLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHL0IsV0FBVyJ9