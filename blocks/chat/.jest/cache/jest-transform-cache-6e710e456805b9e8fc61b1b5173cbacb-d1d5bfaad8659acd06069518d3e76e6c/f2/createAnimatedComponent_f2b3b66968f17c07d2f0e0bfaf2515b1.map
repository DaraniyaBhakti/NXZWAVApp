{"version":3,"names":["_interopRequireDefault","require","_extends2","_classCallCheck2","_createClass2","_inherits2","_possibleConstructorReturn2","_getPrototypeOf2","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","default","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","_require","AnimatedEvent","AnimatedProps","React","DeprecatedViewStylePropTypes","invariant","createAnimatedComponent","Component","defaultProps","isReactComponent","AnimatedComponent","_React$Component","_super","props","_this","_invokeAnimatedPropsCallbackOnMount","_eventDetachers","_animatedPropsCallback","_component","__skipSetNativeProps_FOR_TESTS_ONLY","setNativeProps","forceUpdate","_propsAnimated","__isNative","__getAnimatedValue","Error","_setComponentRef","c","_prevComponent","key","value","componentWillUnmount","__detach","_detachNativeEvents","UNSAFE_componentWillMount","_attachProps","componentDidMount","setNativeView","_attachNativeEvents","_this$_component","_this2","scrollableNode","getScrollableNode","_loop","prop","__attach","push","forEach","remove","nextProps","oldPropsAnimated","UNSAFE_componentWillReceiveProps","newProps","componentDidUpdate","prevProps","render","__getValue","createElement","ref","collapsable","getNode","propTypes","style","propName","componentName","undefined","console","warn","module","exports"],"sources":["createAnimatedComponent.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n'use strict';\n\nconst {AnimatedEvent} = require('./AnimatedEvent');\nconst AnimatedProps = require('./nodes/AnimatedProps');\nconst React = require('react');\nconst DeprecatedViewStylePropTypes = require('../../DeprecatedPropTypes/DeprecatedViewStylePropTypes');\n\nconst invariant = require('invariant');\n\nfunction createAnimatedComponent(Component: any, defaultProps: any): any {\n  invariant(\n    typeof Component !== 'function' ||\n      (Component.prototype && Component.prototype.isReactComponent),\n    '`createAnimatedComponent` does not support stateless functional components; ' +\n      'use a class component instead.',\n  );\n\n  class AnimatedComponent extends React.Component<Object> {\n    _component: any;\n    _invokeAnimatedPropsCallbackOnMount: boolean = false;\n    _prevComponent: any;\n    _propsAnimated: AnimatedProps;\n    _eventDetachers: Array<Function> = [];\n\n    static __skipSetNativeProps_FOR_TESTS_ONLY = false;\n\n    constructor(props: Object) {\n      super(props);\n    }\n\n    componentWillUnmount() {\n      this._propsAnimated && this._propsAnimated.__detach();\n      this._detachNativeEvents();\n    }\n\n    setNativeProps(props) {\n      this._component.setNativeProps(props);\n    }\n\n    UNSAFE_componentWillMount() {\n      this._attachProps(this.props);\n    }\n\n    componentDidMount() {\n      if (this._invokeAnimatedPropsCallbackOnMount) {\n        this._invokeAnimatedPropsCallbackOnMount = false;\n        this._animatedPropsCallback();\n      }\n\n      this._propsAnimated.setNativeView(this._component);\n      this._attachNativeEvents();\n    }\n\n    _attachNativeEvents() {\n      // Make sure to get the scrollable node for components that implement\n      // `ScrollResponder.Mixin`.\n      const scrollableNode = this._component?.getScrollableNode\n        ? this._component.getScrollableNode()\n        : this._component;\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (prop instanceof AnimatedEvent && prop.__isNative) {\n          prop.__attach(scrollableNode, key);\n          this._eventDetachers.push(() => prop.__detach(scrollableNode, key));\n        }\n      }\n    }\n\n    _detachNativeEvents() {\n      this._eventDetachers.forEach(remove => remove());\n      this._eventDetachers = [];\n    }\n\n    // The system is best designed when setNativeProps is implemented. It is\n    // able to avoid re-rendering and directly set the attributes that changed.\n    // However, setNativeProps can only be implemented on leaf native\n    // components. If you want to animate a composite component, you need to\n    // re-render it. In this case, we have a fallback that uses forceUpdate.\n    _animatedPropsCallback = () => {\n      if (this._component == null) {\n        // AnimatedProps is created in will-mount because it's used in render.\n        // But this callback may be invoked before mount in async mode,\n        // In which case we should defer the setNativeProps() call.\n        // React may throw away uncommitted work in async mode,\n        // So a deferred call won't always be invoked.\n        this._invokeAnimatedPropsCallbackOnMount = true;\n      } else if (\n        AnimatedComponent.__skipSetNativeProps_FOR_TESTS_ONLY ||\n        typeof this._component.setNativeProps !== 'function'\n      ) {\n        this.forceUpdate();\n      } else if (!this._propsAnimated.__isNative) {\n        this._component.setNativeProps(\n          this._propsAnimated.__getAnimatedValue(),\n        );\n      } else {\n        throw new Error(\n          'Attempting to run JS driven animation on animated ' +\n            'node that has been moved to \"native\" earlier by starting an ' +\n            'animation with `useNativeDriver: true`',\n        );\n      }\n    };\n\n    _attachProps(nextProps) {\n      const oldPropsAnimated = this._propsAnimated;\n\n      this._propsAnimated = new AnimatedProps(\n        nextProps,\n        this._animatedPropsCallback,\n      );\n\n      // When you call detach, it removes the element from the parent list\n      // of children. If it goes to 0, then the parent also detaches itself\n      // and so on.\n      // An optimization is to attach the new elements and THEN detach the old\n      // ones instead of detaching and THEN attaching.\n      // This way the intermediate state isn't to go to 0 and trigger\n      // this expensive recursive detaching to then re-attach everything on\n      // the very next operation.\n      oldPropsAnimated && oldPropsAnimated.__detach();\n    }\n\n    UNSAFE_componentWillReceiveProps(newProps) {\n      this._attachProps(newProps);\n    }\n\n    componentDidUpdate(prevProps) {\n      if (this._component !== this._prevComponent) {\n        this._propsAnimated.setNativeView(this._component);\n      }\n      if (this._component !== this._prevComponent || prevProps !== this.props) {\n        this._detachNativeEvents();\n        this._attachNativeEvents();\n      }\n    }\n\n    render() {\n      const props = this._propsAnimated.__getValue();\n      return (\n        <Component\n          {...defaultProps}\n          {...props}\n          ref={this._setComponentRef}\n          // The native driver updates views directly through the UI thread so we\n          // have to make sure the view doesn't get optimized away because it cannot\n          // go through the NativeViewHierarchyManager since it operates on the shadow\n          // thread.\n          collapsable={\n            this._propsAnimated.__isNative ? false : props.collapsable\n          }\n        />\n      );\n    }\n\n    _setComponentRef = c => {\n      this._prevComponent = this._component;\n      this._component = c;\n    };\n\n    // A third party library can use getNode()\n    // to get the node reference of the decorated component\n    getNode() {\n      return this._component;\n    }\n  }\n\n  const propTypes = Component.propTypes;\n\n  AnimatedComponent.propTypes = {\n    style: function(props, propName, componentName) {\n      if (!propTypes) {\n        return;\n      }\n\n      for (const key in DeprecatedViewStylePropTypes) {\n        if (!propTypes[key] && props[key] !== undefined) {\n          console.warn(\n            'You are setting the style `{ ' +\n              key +\n              ': ... }` as a prop. You ' +\n              'should nest it in a style object. ' +\n              'E.g. `{ style: { ' +\n              key +\n              ': ... } }`',\n          );\n        }\n      }\n    },\n  };\n\n  return AnimatedComponent;\n}\n\nmodule.exports = createAnimatedComponent;\n"],"mappings":"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"}