0f16dc62b4696803e22722781df3d6f5
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
var _require = require('./AnimatedEvent'),
  AnimatedEvent = _require.AnimatedEvent;
var AnimatedProps = require('./nodes/AnimatedProps');
var React = require('react');
var DeprecatedViewStylePropTypes = require('../../DeprecatedPropTypes/DeprecatedViewStylePropTypes');
var invariant = require('invariant');
function createAnimatedComponent(Component, defaultProps) {
  invariant(typeof Component !== 'function' || Component.prototype && Component.prototype.isReactComponent, '`createAnimatedComponent` does not support stateless functional components; ' + 'use a class component instead.');
  var AnimatedComponent = function (_React$Component) {
    (0, _inherits2.default)(AnimatedComponent, _React$Component);
    var _super = _createSuper(AnimatedComponent);
    function AnimatedComponent(props) {
      var _this;
      (0, _classCallCheck2.default)(this, AnimatedComponent);
      _this = _super.call(this, props);
      _this._invokeAnimatedPropsCallbackOnMount = false;
      _this._eventDetachers = [];
      _this._animatedPropsCallback = function () {
        if (_this._component == null) {
          _this._invokeAnimatedPropsCallbackOnMount = true;
        } else if (AnimatedComponent.__skipSetNativeProps_FOR_TESTS_ONLY || typeof _this._component.setNativeProps !== 'function') {
          _this.forceUpdate();
        } else if (!_this._propsAnimated.__isNative) {
          _this._component.setNativeProps(_this._propsAnimated.__getAnimatedValue());
        } else {
          throw new Error('Attempting to run JS driven animation on animated ' + 'node that has been moved to "native" earlier by starting an ' + 'animation with `useNativeDriver: true`');
        }
      };
      _this._setComponentRef = function (c) {
        _this._prevComponent = _this._component;
        _this._component = c;
      };
      return _this;
    }
    (0, _createClass2.default)(AnimatedComponent, [{
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        this._propsAnimated && this._propsAnimated.__detach();
        this._detachNativeEvents();
      }
    }, {
      key: "setNativeProps",
      value: function setNativeProps(props) {
        this._component.setNativeProps(props);
      }
    }, {
      key: "UNSAFE_componentWillMount",
      value: function UNSAFE_componentWillMount() {
        this._attachProps(this.props);
      }
    }, {
      key: "componentDidMount",
      value: function componentDidMount() {
        if (this._invokeAnimatedPropsCallbackOnMount) {
          this._invokeAnimatedPropsCallbackOnMount = false;
          this._animatedPropsCallback();
        }
        this._propsAnimated.setNativeView(this._component);
        this._attachNativeEvents();
      }
    }, {
      key: "_attachNativeEvents",
      value: function _attachNativeEvents() {
        var _this$_component,
          _this2 = this;
        var scrollableNode = (_this$_component = this._component) != null && _this$_component.getScrollableNode ? this._component.getScrollableNode() : this._component;
        var _loop = function _loop(key) {
          var prop = _this2.props[key];
          if (prop instanceof AnimatedEvent && prop.__isNative) {
            prop.__attach(scrollableNode, key);
            _this2._eventDetachers.push(function () {
              return prop.__detach(scrollableNode, key);
            });
          }
        };
        for (var key in this.props) {
          _loop(key);
        }
      }
    }, {
      key: "_detachNativeEvents",
      value: function _detachNativeEvents() {
        this._eventDetachers.forEach(function (remove) {
          return remove();
        });
        this._eventDetachers = [];
      }
    }, {
      key: "_attachProps",
      value: function _attachProps(nextProps) {
        var oldPropsAnimated = this._propsAnimated;
        this._propsAnimated = new AnimatedProps(nextProps, this._animatedPropsCallback);
        oldPropsAnimated && oldPropsAnimated.__detach();
      }
    }, {
      key: "UNSAFE_componentWillReceiveProps",
      value: function UNSAFE_componentWillReceiveProps(newProps) {
        this._attachProps(newProps);
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate(prevProps) {
        if (this._component !== this._prevComponent) {
          this._propsAnimated.setNativeView(this._component);
        }
        if (this._component !== this._prevComponent || prevProps !== this.props) {
          this._detachNativeEvents();
          this._attachNativeEvents();
        }
      }
    }, {
      key: "render",
      value: function render() {
        var props = this._propsAnimated.__getValue();
        return React.createElement(Component, (0, _extends2.default)({}, defaultProps, props, {
          ref: this._setComponentRef,
          collapsable: this._propsAnimated.__isNative ? false : props.collapsable
        }));
      }
    }, {
      key: "getNode",
      value: function getNode() {
        return this._component;
      }
    }]);
    return AnimatedComponent;
  }(React.Component);
  AnimatedComponent.__skipSetNativeProps_FOR_TESTS_ONLY = false;
  var propTypes = Component.propTypes;
  AnimatedComponent.propTypes = {
    style: function style(props, propName, componentName) {
      if (!propTypes) {
        return;
      }
      for (var key in DeprecatedViewStylePropTypes) {
        if (!propTypes[key] && props[key] !== undefined) {
          console.warn('You are setting the style `{ ' + key + ': ... }` as a prop. You ' + 'should nest it in a style object. ' + 'E.g. `{ style: { ' + key + ': ... } }`');
        }
      }
    }
  };
  return AnimatedComponent;
}
module.exports = createAnimatedComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9leHRlbmRzMiIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX2luaGVyaXRzMiIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMiIsIl9nZXRQcm90b3R5cGVPZjIiLCJfY3JlYXRlU3VwZXIiLCJEZXJpdmVkIiwiaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCIsIl9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QiLCJfY3JlYXRlU3VwZXJJbnRlcm5hbCIsIlN1cGVyIiwiZGVmYXVsdCIsInJlc3VsdCIsIk5ld1RhcmdldCIsImNvbnN0cnVjdG9yIiwiUmVmbGVjdCIsImNvbnN0cnVjdCIsImFyZ3VtZW50cyIsImFwcGx5Iiwic2hhbSIsIlByb3h5IiwiQm9vbGVhbiIsInByb3RvdHlwZSIsInZhbHVlT2YiLCJjYWxsIiwiZSIsIl9yZXF1aXJlIiwiQW5pbWF0ZWRFdmVudCIsIkFuaW1hdGVkUHJvcHMiLCJSZWFjdCIsIkRlcHJlY2F0ZWRWaWV3U3R5bGVQcm9wVHlwZXMiLCJpbnZhcmlhbnQiLCJjcmVhdGVBbmltYXRlZENvbXBvbmVudCIsIkNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyIsImlzUmVhY3RDb21wb25lbnQiLCJBbmltYXRlZENvbXBvbmVudCIsIl9SZWFjdCRDb21wb25lbnQiLCJfc3VwZXIiLCJwcm9wcyIsIl90aGlzIiwiX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQiLCJfZXZlbnREZXRhY2hlcnMiLCJfYW5pbWF0ZWRQcm9wc0NhbGxiYWNrIiwiX2NvbXBvbmVudCIsIl9fc2tpcFNldE5hdGl2ZVByb3BzX0ZPUl9URVNUU19PTkxZIiwic2V0TmF0aXZlUHJvcHMiLCJmb3JjZVVwZGF0ZSIsIl9wcm9wc0FuaW1hdGVkIiwiX19pc05hdGl2ZSIsIl9fZ2V0QW5pbWF0ZWRWYWx1ZSIsIkVycm9yIiwiX3NldENvbXBvbmVudFJlZiIsImMiLCJfcHJldkNvbXBvbmVudCIsImtleSIsInZhbHVlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJfX2RldGFjaCIsIl9kZXRhY2hOYXRpdmVFdmVudHMiLCJVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50IiwiX2F0dGFjaFByb3BzIiwiY29tcG9uZW50RGlkTW91bnQiLCJzZXROYXRpdmVWaWV3IiwiX2F0dGFjaE5hdGl2ZUV2ZW50cyIsIl90aGlzJF9jb21wb25lbnQiLCJfdGhpczIiLCJzY3JvbGxhYmxlTm9kZSIsImdldFNjcm9sbGFibGVOb2RlIiwiX2xvb3AiLCJwcm9wIiwiX19hdHRhY2giLCJwdXNoIiwiZm9yRWFjaCIsInJlbW92ZSIsIm5leHRQcm9wcyIsIm9sZFByb3BzQW5pbWF0ZWQiLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5ld1Byb3BzIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwicmVuZGVyIiwiX19nZXRWYWx1ZSIsImNyZWF0ZUVsZW1lbnQiLCJyZWYiLCJjb2xsYXBzYWJsZSIsImdldE5vZGUiLCJwcm9wVHlwZXMiLCJzdHlsZSIsInByb3BOYW1lIiwiY29tcG9uZW50TmFtZSIsInVuZGVmaW5lZCIsImNvbnNvbGUiLCJ3YXJuIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCB7QW5pbWF0ZWRFdmVudH0gPSByZXF1aXJlKCcuL0FuaW1hdGVkRXZlbnQnKTtcbmNvbnN0IEFuaW1hdGVkUHJvcHMgPSByZXF1aXJlKCcuL25vZGVzL0FuaW1hdGVkUHJvcHMnKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbmNvbnN0IERlcHJlY2F0ZWRWaWV3U3R5bGVQcm9wVHlwZXMgPSByZXF1aXJlKCcuLi8uLi9EZXByZWNhdGVkUHJvcFR5cGVzL0RlcHJlY2F0ZWRWaWV3U3R5bGVQcm9wVHlwZXMnKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50KENvbXBvbmVudDogYW55LCBkZWZhdWx0UHJvcHM6IGFueSk6IGFueSB7XG4gIGludmFyaWFudChcbiAgICB0eXBlb2YgQ29tcG9uZW50ICE9PSAnZnVuY3Rpb24nIHx8XG4gICAgICAoQ29tcG9uZW50LnByb3RvdHlwZSAmJiBDb21wb25lbnQucHJvdG90eXBlLmlzUmVhY3RDb21wb25lbnQpLFxuICAgICdgY3JlYXRlQW5pbWF0ZWRDb21wb25lbnRgIGRvZXMgbm90IHN1cHBvcnQgc3RhdGVsZXNzIGZ1bmN0aW9uYWwgY29tcG9uZW50czsgJyArXG4gICAgICAndXNlIGEgY2xhc3MgY29tcG9uZW50IGluc3RlYWQuJyxcbiAgKTtcblxuICBjbGFzcyBBbmltYXRlZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxPYmplY3Q+IHtcbiAgICBfY29tcG9uZW50OiBhbnk7XG4gICAgX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfcHJldkNvbXBvbmVudDogYW55O1xuICAgIF9wcm9wc0FuaW1hdGVkOiBBbmltYXRlZFByb3BzO1xuICAgIF9ldmVudERldGFjaGVyczogQXJyYXk8RnVuY3Rpb24+ID0gW107XG5cbiAgICBzdGF0aWMgX19za2lwU2V0TmF0aXZlUHJvcHNfRk9SX1RFU1RTX09OTFkgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBPYmplY3QpIHtcbiAgICAgIHN1cGVyKHByb3BzKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIHRoaXMuX3Byb3BzQW5pbWF0ZWQgJiYgdGhpcy5fcHJvcHNBbmltYXRlZC5fX2RldGFjaCgpO1xuICAgICAgdGhpcy5fZGV0YWNoTmF0aXZlRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgc2V0TmF0aXZlUHJvcHMocHJvcHMpIHtcbiAgICAgIHRoaXMuX2NvbXBvbmVudC5zZXROYXRpdmVQcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpIHtcbiAgICAgIHRoaXMuX2F0dGFjaFByb3BzKHRoaXMucHJvcHMpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgaWYgKHRoaXMuX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQpIHtcbiAgICAgICAgdGhpcy5faW52b2tlQW5pbWF0ZWRQcm9wc0NhbGxiYWNrT25Nb3VudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9hbmltYXRlZFByb3BzQ2FsbGJhY2soKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fcHJvcHNBbmltYXRlZC5zZXROYXRpdmVWaWV3KHRoaXMuX2NvbXBvbmVudCk7XG4gICAgICB0aGlzLl9hdHRhY2hOYXRpdmVFdmVudHMoKTtcbiAgICB9XG5cbiAgICBfYXR0YWNoTmF0aXZlRXZlbnRzKCkge1xuICAgICAgLy8gTWFrZSBzdXJlIHRvIGdldCB0aGUgc2Nyb2xsYWJsZSBub2RlIGZvciBjb21wb25lbnRzIHRoYXQgaW1wbGVtZW50XG4gICAgICAvLyBgU2Nyb2xsUmVzcG9uZGVyLk1peGluYC5cbiAgICAgIGNvbnN0IHNjcm9sbGFibGVOb2RlID0gdGhpcy5fY29tcG9uZW50Py5nZXRTY3JvbGxhYmxlTm9kZVxuICAgICAgICA/IHRoaXMuX2NvbXBvbmVudC5nZXRTY3JvbGxhYmxlTm9kZSgpXG4gICAgICAgIDogdGhpcy5fY29tcG9uZW50O1xuXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnByb3BzKSB7XG4gICAgICAgIGNvbnN0IHByb3AgPSB0aGlzLnByb3BzW2tleV07XG4gICAgICAgIGlmIChwcm9wIGluc3RhbmNlb2YgQW5pbWF0ZWRFdmVudCAmJiBwcm9wLl9faXNOYXRpdmUpIHtcbiAgICAgICAgICBwcm9wLl9fYXR0YWNoKHNjcm9sbGFibGVOb2RlLCBrZXkpO1xuICAgICAgICAgIHRoaXMuX2V2ZW50RGV0YWNoZXJzLnB1c2goKCkgPT4gcHJvcC5fX2RldGFjaChzY3JvbGxhYmxlTm9kZSwga2V5KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBfZGV0YWNoTmF0aXZlRXZlbnRzKCkge1xuICAgICAgdGhpcy5fZXZlbnREZXRhY2hlcnMuZm9yRWFjaChyZW1vdmUgPT4gcmVtb3ZlKCkpO1xuICAgICAgdGhpcy5fZXZlbnREZXRhY2hlcnMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBUaGUgc3lzdGVtIGlzIGJlc3QgZGVzaWduZWQgd2hlbiBzZXROYXRpdmVQcm9wcyBpcyBpbXBsZW1lbnRlZC4gSXQgaXNcbiAgICAvLyBhYmxlIHRvIGF2b2lkIHJlLXJlbmRlcmluZyBhbmQgZGlyZWN0bHkgc2V0IHRoZSBhdHRyaWJ1dGVzIHRoYXQgY2hhbmdlZC5cbiAgICAvLyBIb3dldmVyLCBzZXROYXRpdmVQcm9wcyBjYW4gb25seSBiZSBpbXBsZW1lbnRlZCBvbiBsZWFmIG5hdGl2ZVxuICAgIC8vIGNvbXBvbmVudHMuIElmIHlvdSB3YW50IHRvIGFuaW1hdGUgYSBjb21wb3NpdGUgY29tcG9uZW50LCB5b3UgbmVlZCB0b1xuICAgIC8vIHJlLXJlbmRlciBpdC4gSW4gdGhpcyBjYXNlLCB3ZSBoYXZlIGEgZmFsbGJhY2sgdGhhdCB1c2VzIGZvcmNlVXBkYXRlLlxuICAgIF9hbmltYXRlZFByb3BzQ2FsbGJhY2sgPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5fY29tcG9uZW50ID09IG51bGwpIHtcbiAgICAgICAgLy8gQW5pbWF0ZWRQcm9wcyBpcyBjcmVhdGVkIGluIHdpbGwtbW91bnQgYmVjYXVzZSBpdCdzIHVzZWQgaW4gcmVuZGVyLlxuICAgICAgICAvLyBCdXQgdGhpcyBjYWxsYmFjayBtYXkgYmUgaW52b2tlZCBiZWZvcmUgbW91bnQgaW4gYXN5bmMgbW9kZSxcbiAgICAgICAgLy8gSW4gd2hpY2ggY2FzZSB3ZSBzaG91bGQgZGVmZXIgdGhlIHNldE5hdGl2ZVByb3BzKCkgY2FsbC5cbiAgICAgICAgLy8gUmVhY3QgbWF5IHRocm93IGF3YXkgdW5jb21taXR0ZWQgd29yayBpbiBhc3luYyBtb2RlLFxuICAgICAgICAvLyBTbyBhIGRlZmVycmVkIGNhbGwgd29uJ3QgYWx3YXlzIGJlIGludm9rZWQuXG4gICAgICAgIHRoaXMuX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgQW5pbWF0ZWRDb21wb25lbnQuX19za2lwU2V0TmF0aXZlUHJvcHNfRk9SX1RFU1RTX09OTFkgfHxcbiAgICAgICAgdHlwZW9mIHRoaXMuX2NvbXBvbmVudC5zZXROYXRpdmVQcm9wcyAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgKSB7XG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX3Byb3BzQW5pbWF0ZWQuX19pc05hdGl2ZSkge1xuICAgICAgICB0aGlzLl9jb21wb25lbnQuc2V0TmF0aXZlUHJvcHMoXG4gICAgICAgICAgdGhpcy5fcHJvcHNBbmltYXRlZC5fX2dldEFuaW1hdGVkVmFsdWUoKSxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQXR0ZW1wdGluZyB0byBydW4gSlMgZHJpdmVuIGFuaW1hdGlvbiBvbiBhbmltYXRlZCAnICtcbiAgICAgICAgICAgICdub2RlIHRoYXQgaGFzIGJlZW4gbW92ZWQgdG8gXCJuYXRpdmVcIiBlYXJsaWVyIGJ5IHN0YXJ0aW5nIGFuICcgK1xuICAgICAgICAgICAgJ2FuaW1hdGlvbiB3aXRoIGB1c2VOYXRpdmVEcml2ZXI6IHRydWVgJyxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgX2F0dGFjaFByb3BzKG5leHRQcm9wcykge1xuICAgICAgY29uc3Qgb2xkUHJvcHNBbmltYXRlZCA9IHRoaXMuX3Byb3BzQW5pbWF0ZWQ7XG5cbiAgICAgIHRoaXMuX3Byb3BzQW5pbWF0ZWQgPSBuZXcgQW5pbWF0ZWRQcm9wcyhcbiAgICAgICAgbmV4dFByb3BzLFxuICAgICAgICB0aGlzLl9hbmltYXRlZFByb3BzQ2FsbGJhY2ssXG4gICAgICApO1xuXG4gICAgICAvLyBXaGVuIHlvdSBjYWxsIGRldGFjaCwgaXQgcmVtb3ZlcyB0aGUgZWxlbWVudCBmcm9tIHRoZSBwYXJlbnQgbGlzdFxuICAgICAgLy8gb2YgY2hpbGRyZW4uIElmIGl0IGdvZXMgdG8gMCwgdGhlbiB0aGUgcGFyZW50IGFsc28gZGV0YWNoZXMgaXRzZWxmXG4gICAgICAvLyBhbmQgc28gb24uXG4gICAgICAvLyBBbiBvcHRpbWl6YXRpb24gaXMgdG8gYXR0YWNoIHRoZSBuZXcgZWxlbWVudHMgYW5kIFRIRU4gZGV0YWNoIHRoZSBvbGRcbiAgICAgIC8vIG9uZXMgaW5zdGVhZCBvZiBkZXRhY2hpbmcgYW5kIFRIRU4gYXR0YWNoaW5nLlxuICAgICAgLy8gVGhpcyB3YXkgdGhlIGludGVybWVkaWF0ZSBzdGF0ZSBpc24ndCB0byBnbyB0byAwIGFuZCB0cmlnZ2VyXG4gICAgICAvLyB0aGlzIGV4cGVuc2l2ZSByZWN1cnNpdmUgZGV0YWNoaW5nIHRvIHRoZW4gcmUtYXR0YWNoIGV2ZXJ5dGhpbmcgb25cbiAgICAgIC8vIHRoZSB2ZXJ5IG5leHQgb3BlcmF0aW9uLlxuICAgICAgb2xkUHJvcHNBbmltYXRlZCAmJiBvbGRQcm9wc0FuaW1hdGVkLl9fZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV3UHJvcHMpIHtcbiAgICAgIHRoaXMuX2F0dGFjaFByb3BzKG5ld1Byb3BzKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgICBpZiAodGhpcy5fY29tcG9uZW50ICE9PSB0aGlzLl9wcmV2Q29tcG9uZW50KSB7XG4gICAgICAgIHRoaXMuX3Byb3BzQW5pbWF0ZWQuc2V0TmF0aXZlVmlldyh0aGlzLl9jb21wb25lbnQpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX2NvbXBvbmVudCAhPT0gdGhpcy5fcHJldkNvbXBvbmVudCB8fCBwcmV2UHJvcHMgIT09IHRoaXMucHJvcHMpIHtcbiAgICAgICAgdGhpcy5fZGV0YWNoTmF0aXZlRXZlbnRzKCk7XG4gICAgICAgIHRoaXMuX2F0dGFjaE5hdGl2ZUV2ZW50cygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgIGNvbnN0IHByb3BzID0gdGhpcy5fcHJvcHNBbmltYXRlZC5fX2dldFZhbHVlKCk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Q29tcG9uZW50XG4gICAgICAgICAgey4uLmRlZmF1bHRQcm9wc31cbiAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgcmVmPXt0aGlzLl9zZXRDb21wb25lbnRSZWZ9XG4gICAgICAgICAgLy8gVGhlIG5hdGl2ZSBkcml2ZXIgdXBkYXRlcyB2aWV3cyBkaXJlY3RseSB0aHJvdWdoIHRoZSBVSSB0aHJlYWQgc28gd2VcbiAgICAgICAgICAvLyBoYXZlIHRvIG1ha2Ugc3VyZSB0aGUgdmlldyBkb2Vzbid0IGdldCBvcHRpbWl6ZWQgYXdheSBiZWNhdXNlIGl0IGNhbm5vdFxuICAgICAgICAgIC8vIGdvIHRocm91Z2ggdGhlIE5hdGl2ZVZpZXdIaWVyYXJjaHlNYW5hZ2VyIHNpbmNlIGl0IG9wZXJhdGVzIG9uIHRoZSBzaGFkb3dcbiAgICAgICAgICAvLyB0aHJlYWQuXG4gICAgICAgICAgY29sbGFwc2FibGU9e1xuICAgICAgICAgICAgdGhpcy5fcHJvcHNBbmltYXRlZC5fX2lzTmF0aXZlID8gZmFsc2UgOiBwcm9wcy5jb2xsYXBzYWJsZVxuICAgICAgICAgIH1cbiAgICAgICAgLz5cbiAgICAgICk7XG4gICAgfVxuXG4gICAgX3NldENvbXBvbmVudFJlZiA9IGMgPT4ge1xuICAgICAgdGhpcy5fcHJldkNvbXBvbmVudCA9IHRoaXMuX2NvbXBvbmVudDtcbiAgICAgIHRoaXMuX2NvbXBvbmVudCA9IGM7XG4gICAgfTtcblxuICAgIC8vIEEgdGhpcmQgcGFydHkgbGlicmFyeSBjYW4gdXNlIGdldE5vZGUoKVxuICAgIC8vIHRvIGdldCB0aGUgbm9kZSByZWZlcmVuY2Ugb2YgdGhlIGRlY29yYXRlZCBjb21wb25lbnRcbiAgICBnZXROb2RlKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudDtcbiAgICB9XG4gIH1cblxuICBjb25zdCBwcm9wVHlwZXMgPSBDb21wb25lbnQucHJvcFR5cGVzO1xuXG4gIEFuaW1hdGVkQ29tcG9uZW50LnByb3BUeXBlcyA9IHtcbiAgICBzdHlsZTogZnVuY3Rpb24ocHJvcHMsIHByb3BOYW1lLCBjb21wb25lbnROYW1lKSB7XG4gICAgICBpZiAoIXByb3BUeXBlcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGZvciAoY29uc3Qga2V5IGluIERlcHJlY2F0ZWRWaWV3U3R5bGVQcm9wVHlwZXMpIHtcbiAgICAgICAgaWYgKCFwcm9wVHlwZXNba2V5XSAmJiBwcm9wc1trZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAnWW91IGFyZSBzZXR0aW5nIHRoZSBzdHlsZSBgeyAnICtcbiAgICAgICAgICAgICAga2V5ICtcbiAgICAgICAgICAgICAgJzogLi4uIH1gIGFzIGEgcHJvcC4gWW91ICcgK1xuICAgICAgICAgICAgICAnc2hvdWxkIG5lc3QgaXQgaW4gYSBzdHlsZSBvYmplY3QuICcgK1xuICAgICAgICAgICAgICAnRS5nLiBgeyBzdHlsZTogeyAnICtcbiAgICAgICAgICAgICAga2V5ICtcbiAgICAgICAgICAgICAgJzogLi4uIH0gfWAnLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICB9O1xuXG4gIHJldHVybiBBbmltYXRlZENvbXBvbmVudDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVBbmltYXRlZENvbXBvbmVudDtcbiJdLCJtYXBwaW5ncyI6IkFBU0EsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsU0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUUsZ0JBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFHLGFBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFJLFVBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFLLDJCQUFBLEdBQUFOLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBTSxnQkFBQSxHQUFBUCxzQkFBQSxDQUFBQyxPQUFBO0FBQUEsU0FBQU8sYUFBQUMsT0FBQSxRQUFBQyx5QkFBQSxHQUFBQyx5QkFBQSxvQkFBQUMscUJBQUEsUUFBQUMsS0FBQSxPQUFBTixnQkFBQSxDQUFBTyxPQUFBLEVBQUFMLE9BQUEsR0FBQU0sTUFBQSxNQUFBTCx5QkFBQSxRQUFBTSxTQUFBLE9BQUFULGdCQUFBLENBQUFPLE9BQUEsUUFBQUcsV0FBQSxFQUFBRixNQUFBLEdBQUFHLE9BQUEsQ0FBQUMsU0FBQSxDQUFBTixLQUFBLEVBQUFPLFNBQUEsRUFBQUosU0FBQSxZQUFBRCxNQUFBLEdBQUFGLEtBQUEsQ0FBQVEsS0FBQSxPQUFBRCxTQUFBLGdCQUFBZCwyQkFBQSxDQUFBUSxPQUFBLFFBQUFDLE1BQUE7QUFBQSxTQUFBSiwwQkFBQSxlQUFB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