{"version":3,"names":["EXCLUDED_METHODS","createExtension","storageInstance","propertyNames","Object","getOwnPropertyNames","filter","propName","indexOf","startsWith","extension","forEach","desc","enumerable","get","bind","defineProperty","seal"],"sources":["../src/extension.ts"],"sourcesContent":["/**\n * Copyright (c) React Native Community.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport {ExtensionType, IStorageBackend} from '../types';\n\n// Methods available in storage API, to be excluded from the extension\nconst EXCLUDED_METHODS = [\n  'getSingle',\n  'setSingle',\n  'getMany',\n  'setMany',\n  'removeSingle',\n  'removeMany',\n  'getKeys',\n  'dropStorage',\n];\n\n/*\n * Extension is an object containing 'public', function-type properties of Storage instance\n * To property be include in the extension, it has to meet three conditions:\n * - has public accessor\n * - has to be a function\n * - cannot start with an underscore (convention considered private in JS)\n *\n * All methods in the extensions are called in Storage instance context\n */\nexport function createExtension<T extends IStorageBackend>(\n  storageInstance: T,\n): ExtensionType<T> {\n  const propertyNames = Object.getOwnPropertyNames(storageInstance).filter(\n    propName => {\n      return (\n        EXCLUDED_METHODS.indexOf(propName) === -1 &&\n        !propName.startsWith('_') &&\n        // @ts-ignore this is a property on the instance\n        typeof storageInstance[propName] === 'function'\n      );\n    },\n  );\n\n  let extension = {};\n  propertyNames.forEach(propName => {\n    const desc = {\n      enumerable: true,\n      get: function() {\n        // @ts-ignore this is a property on the instance\n        return storageInstance[propName].bind(storageInstance);\n      },\n    };\n\n    Object.defineProperty(extension, propName, desc);\n  });\n\n  Object.seal(extension);\n  return extension as ExtensionType<T>;\n}\n"],"mappings":";;;;;;AAUA,IAAMA,gBAAgB,GAAG,CACvB,WADuB,EAEvB,WAFuB,EAGvB,SAHuB,EAIvB,SAJuB,EAKvB,cALuB,EAMvB,YANuB,EAOvB,SAPuB,EAQvB,aARuB,CAAzB;AAoBO,SAASC,eAATA,CACLC,eADK,EAEa;EAClB,IAAMC,aAAa,GAAGC,MAAM,CAACC,mBAAP,CAA2BH,eAA3B,EAA4CI,MAA5C,CACpB,UAAAC,QAAQ,EAAI;IACV,OACEP,gBAAgB,CAACQ,OAAjB,CAAyBD,QAAzB,MAAuC,CAAC,CAAxC,IACA,CAACA,QAAQ,CAACE,UAAT,CAAoB,GAApB,CADD,IAGA,OAAOP,eAAe,CAACK,QAAD,CAAtB,KAAqC,UAJvC;EAMD,CARmB,CAAtB;EAWA,IAAIG,SAAS,GAAG,EAAhB;EACAP,aAAa,CAACQ,OAAd,CAAsB,UAAAJ,QAAQ,EAAI;IAChC,IAAMK,IAAI,GAAG;MACXC,UAAU,EAAE,IADD;MAEXC,GAAG,EAAE,SAAAA,IAAA,EAAW;QAEd,OAAOZ,eAAe,CAACK,QAAD,CAAf,CAA0BQ,IAA1B,CAA+Bb,eAA/B,CAAP;MACD;IALU,CAAb;IAQAE,MAAM,CAACY,cAAP,CAAsBN,SAAtB,EAAiCH,QAAjC,EAA2CK,IAA3C;EACD,CAVD;EAYAR,MAAM,CAACa,IAAP,CAAYP,SAAZ;EACA,OAAOA,SAAP;AACD"}