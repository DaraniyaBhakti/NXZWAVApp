fa7db33f3aef98aa2cf5453174d70c29
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
var AnimatedImplementation = require('../../Animated/src/AnimatedImplementation');
var React = require('react');
var StyleSheet = require('../../StyleSheet/StyleSheet');
var View = require('../View/View');
var AnimatedView = AnimatedImplementation.createAnimatedComponent(View);
var ScrollViewStickyHeader = function (_React$Component) {
  (0, _inherits2.default)(ScrollViewStickyHeader, _React$Component);
  var _super = _createSuper(ScrollViewStickyHeader);
  function ScrollViewStickyHeader() {
    var _this;
    (0, _classCallCheck2.default)(this, ScrollViewStickyHeader);
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    _this = _super.call.apply(_super, [this].concat(args));
    _this.state = {
      measured: false,
      layoutY: 0,
      layoutHeight: 0,
      nextHeaderLayoutY: _this.props.nextHeaderLayoutY
    };
    _this._onLayout = function (event) {
      _this.setState({
        measured: true,
        layoutY: event.nativeEvent.layout.y,
        layoutHeight: event.nativeEvent.layout.height
      });
      _this.props.onLayout(event);
      var child = React.Children.only(_this.props.children);
      if (child.props.onLayout) {
        child.props.onLayout(event);
      }
    };
    return _this;
  }
  (0, _createClass2.default)(ScrollViewStickyHeader, [{
    key: "setNextHeaderY",
    value: function setNextHeaderY(y) {
      this.setState({
        nextHeaderLayoutY: y
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
        inverted = _this$props.inverted,
        scrollViewHeight = _this$props.scrollViewHeight;
      var _this$state = this.state,
        measured = _this$state.measured,
        layoutHeight = _this$state.layoutHeight,
        layoutY = _this$state.layoutY,
        nextHeaderLayoutY = _this$state.nextHeaderLayoutY;
      var inputRange = [-1, 0];
      var outputRange = [0, 0];
      if (measured) {
        if (inverted) {
          if (scrollViewHeight != null) {
            var stickStartPoint = layoutY + layoutHeight - scrollViewHeight;
            if (stickStartPoint > 0) {
              inputRange.push(stickStartPoint);
              outputRange.push(0);
              inputRange.push(stickStartPoint + 1);
              outputRange.push(1);
              var collisionPoint = (nextHeaderLayoutY || 0) - layoutHeight - scrollViewHeight;
              if (collisionPoint > stickStartPoint) {
                inputRange.push(collisionPoint, collisionPoint + 1);
                outputRange.push(collisionPoint - stickStartPoint, collisionPoint - stickStartPoint);
              }
            }
          }
        } else {
          inputRange.push(layoutY);
          outputRange.push(0);
          var _collisionPoint = (nextHeaderLayoutY || 0) - layoutHeight;
          if (_collisionPoint >= layoutY) {
            inputRange.push(_collisionPoint, _collisionPoint + 1);
            outputRange.push(_collisionPoint - layoutY, _collisionPoint - layoutY);
          } else {
            inputRange.push(layoutY + 1);
            outputRange.push(1);
          }
        }
      }
      var translateY = this.props.scrollAnimatedValue.interpolate({
        inputRange: inputRange,
        outputRange: outputRange
      });
      var child = React.Children.only(this.props.children);
      return React.createElement(AnimatedView, {
        collapsable: false,
        onLayout: this._onLayout,
        style: [child.props.style, styles.header, {
          transform: [{
            translateY: translateY
          }]
        }]
      }, React.cloneElement(child, {
        style: styles.fill,
        onLayout: undefined
      }));
    }
  }]);
  return ScrollViewStickyHeader;
}(React.Component);
var styles = StyleSheet.create({
  header: {
    zIndex: 10
  },
  fill: {
    flex: 1
  }
});
module.exports = ScrollViewStickyHeader;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX2luaGVyaXRzMiIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMiIsIl9nZXRQcm90b3R5cGVPZjIiLCJfY3JlYXRlU3VwZXIiLCJEZXJpdmVkIiwiaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCIsIl9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QiLCJfY3JlYXRlU3VwZXJJbnRlcm5hbCIsIlN1cGVyIiwiZGVmYXVsdCIsInJlc3VsdCIsIk5ld1RhcmdldCIsImNvbnN0cnVjdG9yIiwiUmVmbGVjdCIsImNvbnN0cnVjdCIsImFyZ3VtZW50cyIsImFwcGx5Iiwic2hhbSIsIlByb3h5IiwiQm9vbGVhbiIsInByb3RvdHlwZSIsInZhbHVlT2YiLCJjYWxsIiwiZSIsIkFuaW1hdGVkSW1wbGVtZW50YXRpb24iLCJSZWFjdCIsIlN0eWxlU2hlZXQiLCJWaWV3IiwiQW5pbWF0ZWRWaWV3IiwiY3JlYXRlQW5pbWF0ZWRDb21wb25lbnQiLCJTY3JvbGxWaWV3U3RpY2t5SGVhZGVyIiwiX1JlYWN0JENvbXBvbmVudCIsIl9zdXBlciIsIl90aGlzIiwiX2xlbiIsImxlbmd0aCIsImFyZ3MiLCJBcnJheSIsIl9rZXkiLCJjb25jYXQiLCJzdGF0ZSIsIm1lYXN1cmVkIiwibGF5b3V0WSIsImxheW91dEhlaWdodCIsIm5leHRIZWFkZXJMYXlvdXRZIiwicHJvcHMiLCJfb25MYXlvdXQiLCJldmVudCIsInNldFN0YXRlIiwibmF0aXZlRXZlbnQiLCJsYXlvdXQiLCJ5IiwiaGVpZ2h0Iiwib25MYXlvdXQiLCJjaGlsZCIsIkNoaWxkcmVuIiwib25seSIsImNoaWxkcmVuIiwia2V5IiwidmFsdWUiLCJzZXROZXh0SGVhZGVyWSIsInJlbmRlciIsIl90aGlzJHByb3BzIiwiaW52ZXJ0ZWQiLCJzY3JvbGxWaWV3SGVpZ2h0IiwiX3RoaXMkc3RhdGUiLCJpbnB1dFJhbmdlIiwib3V0cHV0UmFuZ2UiLCJzdGlja1N0YXJ0UG9pbnQiLCJwdXNoIiwiY29sbGlzaW9uUG9pbnQiLCJ0cmFuc2xhdGVZIiwic2Nyb2xsQW5pbWF0ZWRWYWx1ZSIsImludGVycG9sYXRlIiwiY3JlYXRlRWxlbWVudCIsImNvbGxhcHNhYmxlIiwic3R5bGUiLCJzdHlsZXMiLCJoZWFkZXIiLCJ0cmFuc2Zvcm0iLCJjbG9uZUVsZW1lbnQiLCJmaWxsIiwidW5kZWZpbmVkIiwiQ29tcG9uZW50IiwiY3JlYXRlIiwiekluZGV4IiwiZmxleCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJTY3JvbGxWaWV3U3RpY2t5SGVhZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBBbmltYXRlZEltcGxlbWVudGF0aW9uID0gcmVxdWlyZSgnLi4vLi4vQW5pbWF0ZWQvc3JjL0FuaW1hdGVkSW1wbGVtZW50YXRpb24nKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbmNvbnN0IFN0eWxlU2hlZXQgPSByZXF1aXJlKCcuLi8uLi9TdHlsZVNoZWV0L1N0eWxlU2hlZXQnKTtcbmNvbnN0IFZpZXcgPSByZXF1aXJlKCcuLi9WaWV3L1ZpZXcnKTtcblxuaW1wb3J0IHR5cGUge0xheW91dEV2ZW50fSBmcm9tICcuLi8uLi9UeXBlcy9Db3JlRXZlbnRUeXBlcyc7XG5cbmNvbnN0IEFuaW1hdGVkVmlldyA9IEFuaW1hdGVkSW1wbGVtZW50YXRpb24uY3JlYXRlQW5pbWF0ZWRDb21wb25lbnQoVmlldyk7XG5cbmV4cG9ydCB0eXBlIFByb3BzID0ge1xuICBjaGlsZHJlbj86IFJlYWN0LkVsZW1lbnQ8YW55PixcbiAgbmV4dEhlYWRlckxheW91dFk6ID9udW1iZXIsXG4gIG9uTGF5b3V0OiAoZXZlbnQ6IExheW91dEV2ZW50KSA9PiB2b2lkLFxuICBzY3JvbGxBbmltYXRlZFZhbHVlOiBBbmltYXRlZEltcGxlbWVudGF0aW9uLlZhbHVlLFxuICAvLyBXaWxsIGNhdXNlIHN0aWNreSBoZWFkZXJzIHRvIHN0aWNrIGF0IHRoZSBib3R0b20gb2YgdGhlIFNjcm9sbFZpZXcgaW5zdGVhZFxuICAvLyBvZiB0aGUgdG9wLlxuICBpbnZlcnRlZDogP2Jvb2xlYW4sXG4gIC8vIFRoZSBoZWlnaHQgb2YgdGhlIHBhcmVudCBTY3JvbGxWaWV3LiBDdXJyZW50bHkgb25seSBzZXQgd2hlbiBpbnZlcnRlZC5cbiAgc2Nyb2xsVmlld0hlaWdodDogP251bWJlcixcbn07XG5cbnR5cGUgU3RhdGUgPSB7XG4gIG1lYXN1cmVkOiBib29sZWFuLFxuICBsYXlvdXRZOiBudW1iZXIsXG4gIGxheW91dEhlaWdodDogbnVtYmVyLFxuICBuZXh0SGVhZGVyTGF5b3V0WTogP251bWJlcixcbn07XG5cbmNsYXNzIFNjcm9sbFZpZXdTdGlja3lIZWFkZXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHMsIFN0YXRlPiB7XG4gIHN0YXRlOiBTdGF0ZSA9IHtcbiAgICBtZWFzdXJlZDogZmFsc2UsXG4gICAgbGF5b3V0WTogMCxcbiAgICBsYXlvdXRIZWlnaHQ6IDAsXG4gICAgbmV4dEhlYWRlckxheW91dFk6IHRoaXMucHJvcHMubmV4dEhlYWRlckxheW91dFksXG4gIH07XG5cbiAgc2V0TmV4dEhlYWRlclkoeTogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7bmV4dEhlYWRlckxheW91dFk6IHl9KTtcbiAgfVxuXG4gIF9vbkxheW91dCA9IGV2ZW50ID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIG1lYXN1cmVkOiB0cnVlLFxuICAgICAgbGF5b3V0WTogZXZlbnQubmF0aXZlRXZlbnQubGF5b3V0LnksXG4gICAgICBsYXlvdXRIZWlnaHQ6IGV2ZW50Lm5hdGl2ZUV2ZW50LmxheW91dC5oZWlnaHQsXG4gICAgfSk7XG5cbiAgICB0aGlzLnByb3BzLm9uTGF5b3V0KGV2ZW50KTtcbiAgICBjb25zdCBjaGlsZCA9IFJlYWN0LkNoaWxkcmVuLm9ubHkodGhpcy5wcm9wcy5jaGlsZHJlbik7XG4gICAgaWYgKGNoaWxkLnByb3BzLm9uTGF5b3V0KSB7XG4gICAgICBjaGlsZC5wcm9wcy5vbkxheW91dChldmVudCk7XG4gICAgfVxuICB9O1xuXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcbiAgICBjb25zdCB7aW52ZXJ0ZWQsIHNjcm9sbFZpZXdIZWlnaHR9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7bWVhc3VyZWQsIGxheW91dEhlaWdodCwgbGF5b3V0WSwgbmV4dEhlYWRlckxheW91dFl9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBpbnB1dFJhbmdlOiBBcnJheTxudW1iZXI+ID0gWy0xLCAwXTtcbiAgICBjb25zdCBvdXRwdXRSYW5nZTogQXJyYXk8bnVtYmVyPiA9IFswLCAwXTtcblxuICAgIGlmIChtZWFzdXJlZCkge1xuICAgICAgaWYgKGludmVydGVkKSB7XG4gICAgICAgIC8vIFRoZSBpbnRlcnBvbGF0aW9uIGxvb2tzIGxpa2U6XG4gICAgICAgIC8vIC0gTmVnYXRpdmUgc2Nyb2xsOiBubyB0cmFuc2xhdGlvblxuICAgICAgICAvLyAtIGBzdGlja1N0YXJ0UG9pbnRgIGlzIHRoZSBwb2ludCBhdCB3aGljaCB0aGUgaGVhZGVyIHdpbGwgc3RhcnQgc3RpY2tpbmcuXG4gICAgICAgIC8vICAgSXQgaXMgY2FsY3VsYXRlZCB1c2luZyB0aGUgU2Nyb2xsVmlldyB2aWV3cG9ydCBoZWlnaHQgc28gaXQgaXMgYSB0aGUgYm90dG9tLlxuICAgICAgICAvLyAtIEhlYWRlcnMgdGhhdCBhcmUgaW4gdGhlIGluaXRpYWwgdmlld3BvcnQgd2lsbCBuZXZlciBzdGljaywgYHN0aWNrU3RhcnRQb2ludGBcbiAgICAgICAgLy8gICB3aWxsIGJlIG5lZ2F0aXZlLlxuICAgICAgICAvLyAtIEZyb20gMCB0byBgc3RpY2tTdGFydFBvaW50YCBubyB0cmFuc2xhdGlvbi4gVGhpcyB3aWxsIGNhdXNlIHRoZSBoZWFkZXJcbiAgICAgICAgLy8gICB0byBzY3JvbGwgbm9ybWFsbHkgdW50aWwgaXQgcmVhY2hlcyB0aGUgdG9wIG9mIHRoZSBzY3JvbGwgdmlldy5cbiAgICAgICAgLy8gLSBGcm9tIGBzdGlja1N0YXJ0UG9pbnRgIHRvIHdoZW4gdGhlIG5leHQgaGVhZGVyIHkgaGl0cyB0aGUgYm90dG9tIGVkZ2Ugb2YgdGhlIGhlYWRlcjogdHJhbnNsYXRlXG4gICAgICAgIC8vICAgZXF1YWxseSB0byBzY3JvbGwuIFRoaXMgd2lsbCBjYXVzZSB0aGUgaGVhZGVyIHRvIHN0YXkgYXQgdGhlIHRvcCBvZiB0aGUgc2Nyb2xsIHZpZXcuXG4gICAgICAgIC8vIC0gUGFzdCB0aGUgY29sbGlzaW9uIHdpdGggdGhlIG5leHQgaGVhZGVyIHk6IG5vIG1vcmUgdHJhbnNsYXRpb24uIFRoaXMgd2lsbCBjYXVzZSB0aGVcbiAgICAgICAgLy8gICBoZWFkZXIgdG8gY29udGludWUgc2Nyb2xsaW5nIHVwIGFuZCBtYWtlIHJvb20gZm9yIHRoZSBuZXh0IHN0aWNreSBoZWFkZXIuXG4gICAgICAgIC8vICAgSW4gdGhlIGNhc2UgdGhhdCB0aGVyZSBpcyBubyBuZXh0IGhlYWRlciBqdXN0IHRyYW5zbGF0ZSBlcXVhbGx5IHRvXG4gICAgICAgIC8vICAgc2Nyb2xsIGluZGVmaW5pdGVseS5cbiAgICAgICAgaWYgKHNjcm9sbFZpZXdIZWlnaHQgIT0gbnVsbCkge1xuICAgICAgICAgIGNvbnN0IHN0aWNrU3RhcnRQb2ludCA9IGxheW91dFkgKyBsYXlvdXRIZWlnaHQgLSBzY3JvbGxWaWV3SGVpZ2h0O1xuICAgICAgICAgIGlmIChzdGlja1N0YXJ0UG9pbnQgPiAwKSB7XG4gICAgICAgICAgICBpbnB1dFJhbmdlLnB1c2goc3RpY2tTdGFydFBvaW50KTtcbiAgICAgICAgICAgIG91dHB1dFJhbmdlLnB1c2goMCk7XG4gICAgICAgICAgICBpbnB1dFJhbmdlLnB1c2goc3RpY2tTdGFydFBvaW50ICsgMSk7XG4gICAgICAgICAgICBvdXRwdXRSYW5nZS5wdXNoKDEpO1xuICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgc3RpY2t5IGhlYWRlciBoYXMgbm90IGxvYWRlZCB5ZXQgKHByb2JhYmx5IHdpbmRvd2luZykgb3IgaXMgdGhlIGxhc3RcbiAgICAgICAgICAgIC8vIHdlIGNhbiBqdXN0IGtlZXAgaXQgc3RpY2tlZCBmb3JldmVyLlxuICAgICAgICAgICAgY29uc3QgY29sbGlzaW9uUG9pbnQgPVxuICAgICAgICAgICAgICAobmV4dEhlYWRlckxheW91dFkgfHwgMCkgLSBsYXlvdXRIZWlnaHQgLSBzY3JvbGxWaWV3SGVpZ2h0O1xuICAgICAgICAgICAgaWYgKGNvbGxpc2lvblBvaW50ID4gc3RpY2tTdGFydFBvaW50KSB7XG4gICAgICAgICAgICAgIGlucHV0UmFuZ2UucHVzaChjb2xsaXNpb25Qb2ludCwgY29sbGlzaW9uUG9pbnQgKyAxKTtcbiAgICAgICAgICAgICAgb3V0cHV0UmFuZ2UucHVzaChcbiAgICAgICAgICAgICAgICBjb2xsaXNpb25Qb2ludCAtIHN0aWNrU3RhcnRQb2ludCxcbiAgICAgICAgICAgICAgICBjb2xsaXNpb25Qb2ludCAtIHN0aWNrU3RhcnRQb2ludCxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRoZSBpbnRlcnBvbGF0aW9uIGxvb2tzIGxpa2U6XG4gICAgICAgIC8vIC0gTmVnYXRpdmUgc2Nyb2xsOiBubyB0cmFuc2xhdGlvblxuICAgICAgICAvLyAtIEZyb20gMCB0byB0aGUgeSBvZiB0aGUgaGVhZGVyOiBubyB0cmFuc2xhdGlvbi4gVGhpcyB3aWxsIGNhdXNlIHRoZSBoZWFkZXJcbiAgICAgICAgLy8gICB0byBzY3JvbGwgbm9ybWFsbHkgdW50aWwgaXQgcmVhY2hlcyB0aGUgdG9wIG9mIHRoZSBzY3JvbGwgdmlldy5cbiAgICAgICAgLy8gLSBGcm9tIGhlYWRlciB5IHRvIHdoZW4gdGhlIG5leHQgaGVhZGVyIHkgaGl0cyB0aGUgYm90dG9tIGVkZ2Ugb2YgdGhlIGhlYWRlcjogdHJhbnNsYXRlXG4gICAgICAgIC8vICAgZXF1YWxseSB0byBzY3JvbGwuIFRoaXMgd2lsbCBjYXVzZSB0aGUgaGVhZGVyIHRvIHN0YXkgYXQgdGhlIHRvcCBvZiB0aGUgc2Nyb2xsIHZpZXcuXG4gICAgICAgIC8vIC0gUGFzdCB0aGUgY29sbGlzaW9uIHdpdGggdGhlIG5leHQgaGVhZGVyIHk6IG5vIG1vcmUgdHJhbnNsYXRpb24uIFRoaXMgd2lsbCBjYXVzZSB0aGVcbiAgICAgICAgLy8gICBoZWFkZXIgdG8gY29udGludWUgc2Nyb2xsaW5nIHVwIGFuZCBtYWtlIHJvb20gZm9yIHRoZSBuZXh0IHN0aWNreSBoZWFkZXIuXG4gICAgICAgIC8vICAgSW4gdGhlIGNhc2UgdGhhdCB0aGVyZSBpcyBubyBuZXh0IGhlYWRlciBqdXN0IHRyYW5zbGF0ZSBlcXVhbGx5IHRvXG4gICAgICAgIC8vICAgc2Nyb2xsIGluZGVmaW5pdGVseS5cbiAgICAgICAgaW5wdXRSYW5nZS5wdXNoKGxheW91dFkpO1xuICAgICAgICBvdXRwdXRSYW5nZS5wdXNoKDApO1xuICAgICAgICAvLyBJZiB0aGUgbmV4dCBzdGlja3kgaGVhZGVyIGhhcyBub3QgbG9hZGVkIHlldCAocHJvYmFibHkgd2luZG93aW5nKSBvciBpcyB0aGUgbGFzdFxuICAgICAgICAvLyB3ZSBjYW4ganVzdCBrZWVwIGl0IHN0aWNrZWQgZm9yZXZlci5cbiAgICAgICAgY29uc3QgY29sbGlzaW9uUG9pbnQgPSAobmV4dEhlYWRlckxheW91dFkgfHwgMCkgLSBsYXlvdXRIZWlnaHQ7XG4gICAgICAgIGlmIChjb2xsaXNpb25Qb2ludCA+PSBsYXlvdXRZKSB7XG4gICAgICAgICAgaW5wdXRSYW5nZS5wdXNoKGNvbGxpc2lvblBvaW50LCBjb2xsaXNpb25Qb2ludCArIDEpO1xuICAgICAgICAgIG91dHB1dFJhbmdlLnB1c2goY29sbGlzaW9uUG9pbnQgLSBsYXlvdXRZLCBjb2xsaXNpb25Qb2ludCAtIGxheW91dFkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlucHV0UmFuZ2UucHVzaChsYXlvdXRZICsgMSk7XG4gICAgICAgICAgb3V0cHV0UmFuZ2UucHVzaCgxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHRyYW5zbGF0ZVkgPSB0aGlzLnByb3BzLnNjcm9sbEFuaW1hdGVkVmFsdWUuaW50ZXJwb2xhdGUoe1xuICAgICAgaW5wdXRSYW5nZSxcbiAgICAgIG91dHB1dFJhbmdlLFxuICAgIH0pO1xuICAgIGNvbnN0IGNoaWxkID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8QW5pbWF0ZWRWaWV3XG4gICAgICAgIGNvbGxhcHNhYmxlPXtmYWxzZX1cbiAgICAgICAgb25MYXlvdXQ9e3RoaXMuX29uTGF5b3V0fVxuICAgICAgICBzdHlsZT17W2NoaWxkLnByb3BzLnN0eWxlLCBzdHlsZXMuaGVhZGVyLCB7dHJhbnNmb3JtOiBbe3RyYW5zbGF0ZVl9XX1dfT5cbiAgICAgICAge1JlYWN0LmNsb25lRWxlbWVudChjaGlsZCwge1xuICAgICAgICAgIHN0eWxlOiBzdHlsZXMuZmlsbCwgLy8gV2UgdHJhbnNmZXIgdGhlIGNoaWxkIHN0eWxlIHRvIHRoZSB3cmFwcGVyLlxuICAgICAgICAgIG9uTGF5b3V0OiB1bmRlZmluZWQsIC8vIHdlIGNhbGwgdGhpcyBtYW51YWxseSB0aHJvdWdoIG91ciB0aGlzLl9vbkxheW91dFxuICAgICAgICB9KX1cbiAgICAgIDwvQW5pbWF0ZWRWaWV3PlxuICAgICk7XG4gIH1cbn1cblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBoZWFkZXI6IHtcbiAgICB6SW5kZXg6IDEwLFxuICB9LFxuICBmaWxsOiB7XG4gICAgZmxleDogMSxcbiAgfSxcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjcm9sbFZpZXdTdGlja3lIZWFkZXI7XG4iXSwibWFwcGluZ3MiOiJBQVNBLFlBQVk7O0FBQUMsSUFBQUEsc0JBQUEsR0FBQUMsT0FBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBRSxhQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBRyxVQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBSSwyQkFBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUssZ0JBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLFNBQUFNLGFBQUFDLE9BQUEsUUFBQUMseUJBQUEsR0FBQUMseUJBQUEsb0JBQUFDLHFCQUFBLFFBQUFDLEtBQUEsT0FBQU4sZ0JBQUEsQ0FBQU8sT0FBQSxFQUFBTCxPQUFBLEdBQUFNLE1BQUEsTUFBQUwseUJBQUEsUUFBQU0sU0FBQSxPQUFBVCxnQkFBQSxDQUFBTyxPQUFBLFFBQUFHLFdBQUEsRUFBQUYsTUFBQSxHQUFBRyxPQUFBLENBQUFDLFNBQUEsQ0FBQU4sS0FBQSxFQUFBTyxTQUFBLEVBQUFKLFNBQUEsWUFBQUQsTUFBQSxHQUFBRixLQUFBLENBQUFRLEtBQUEsT0FBQUQsU0FBQSxnQkFBQWQsMkJBQUEsQ0FBQVEsT0FBQSxRQUFBQyxNQUFBO0FBQUEsU0FBQUosMEJBQUEsZUFBQU8sT0FBQSxxQkFBQUEsT0FBQSxDQUFBQyxTQUFBLG9CQUFBRCxPQUFBLENBQUFDLFNBQUEsQ0FBQUcsSUFBQSwyQkFBQUMsS0FBQSxvQ0FBQUMsT0FBQSxDQUFBQyxTQUFBLENB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